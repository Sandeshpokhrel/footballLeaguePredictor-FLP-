{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "72266485",
   "metadata": {
    "_cell_guid": "b1076dfc-b9ad-4769-8c92-a6c4dae69d19",
    "_uuid": "8f2839f25d086af736a60e9eeb907d3b93b6e0e5",
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:06.361077Z",
     "iopub.status.busy": "2025-05-06T13:18:06.360734Z",
     "iopub.status.idle": "2025-05-06T13:18:08.279531Z",
     "shell.execute_reply": "2025-05-06T13:18:08.278429Z"
    },
    "papermill": {
     "duration": 1.926391,
     "end_time": "2025-05-06T13:18:08.281172",
     "exception": false,
     "start_time": "2025-05-06T13:18:06.354781",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/kaggle/input/epl-with-labels-matchday/EPL.csv\n",
      "/kaggle/input/club-football-match-data-2000-2025/Matches.csv\n",
      "/kaggle/input/club-football-match-data-2000-2025/EloRatings.csv\n",
      "/kaggle/input/epl-dataset-csv/EPL.csv\n"
     ]
    }
   ],
   "source": [
    "# This Python 3 environment comes with many helpful analytics libraries installed\n",
    "# It is defined by the kaggle/python Docker image: https://github.com/kaggle/docker-python\n",
    "# For example, here's several helpful packages to load\n",
    "\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import os\n",
    "\n",
    "# Input data files are available in the read-only \"../input/\" directory\n",
    "# For example, running this (by clicking run or pressing Shift+Enter) will list all files under the input directory\n",
    "\n",
    "import os\n",
    "for dirname, _, filenames in os.walk('/kaggle/input'):\n",
    "    for filename in filenames:\n",
    "        print(os.path.join(dirname, filename))\n",
    "\n",
    "# You can write up to 20GB to the current directory (/kaggle/working/) that gets preserved as output when you create a version using \"Save & Run All\" \n",
    "# You can also write temporary files to /kaggle/temp/, but they won't be saved outside of the current session"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "34614eeb",
   "metadata": {
    "papermill": {
     "duration": 0.004132,
     "end_time": "2025-05-06T13:18:08.289883",
     "exception": false,
     "start_time": "2025-05-06T13:18:08.285751",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# *DATA PREPROCESSING AND FEATURE ENGINEERING* "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "0554b308",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:08.300836Z",
     "iopub.status.busy": "2025-05-06T13:18:08.300305Z",
     "iopub.status.idle": "2025-05-06T13:18:08.313157Z",
     "shell.execute_reply": "2025-05-06T13:18:08.312258Z"
    },
    "papermill": {
     "duration": 0.020078,
     "end_time": "2025-05-06T13:18:08.315096",
     "exception": false,
     "start_time": "2025-05-06T13:18:08.295018",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "def preprocess_data(path):\n",
    "    \"\"\"\n",
    "    Preprocess the data by loading it from a CSV file, renaming columns, and converting data types.\n",
    "    \"\"\"\n",
    "    df = pd.read_csv(path)\n",
    "    df.sort_values(['date'], inplace=True)\n",
    "    df.reset_index(drop=True, inplace=True)\n",
    "    df['date'] = pd.to_datetime(df['date'])\n",
    "    df['result'] = pd.to_numeric(df['result'].replace({'w': 3, 'd': 1, 'l': 0}), errors='coerce')\n",
    "    df['result'] = df['result'].fillna(0).round().astype(int)\n",
    "    df.head(20)\n",
    "\n",
    "    # Safe division function\n",
    "    def safe_divide(a, b):\n",
    "        return np.divide(a, b, out=np.zeros_like(a), where=b!=0)\n",
    "\n",
    "    # Create team views with safe calculations\n",
    "    team_cols = ['date', 'team', 'team_form', 'xG', 'shots', 'shotOnTarget', 'deep', 'is_home', 'possession_proxy', 'final_pos']\n",
    "    \n",
    "    df_home = df.assign(\n",
    "        team=df['home_team'],\n",
    "        team_form=df['result'],\n",
    "        is_home=1,\n",
    "        final_pos= df['home_final_pos'],\n",
    "        possession_proxy=(\n",
    "            0.3 * safe_divide(df['xG_home'], df['xG_home']+df['xG_away']) +\n",
    "            0.3 * safe_divide(df['home_shots'], df['home_shots']+df['away_shots']) +\n",
    "            0.4 * safe_divide(df['home_deep'], df['home_deep']+df['away_deep'])\n",
    "        )\n",
    "    ).rename(columns={\n",
    "        'xG_home': 'xG',\n",
    "        'home_shots': 'shots',\n",
    "        'home_shotOnTarget': 'shotOnTarget',\n",
    "        'home_deep': 'deep'\n",
    "    })[team_cols]\n",
    "\n",
    "    df_away = df.assign(\n",
    "        team=df['away_team'],\n",
    "        team_form=df['result'].replace({3: 0, 0: 3}),\n",
    "        is_home=0,\n",
    "        final_pos= df['away_final_pos'],\n",
    "        possession_proxy=(\n",
    "            0.3 * safe_divide(df['xG_away'], df['xG_home']+df['xG_away']) +\n",
    "            0.3 * safe_divide(df['away_shots'], df['home_shots']+df['away_shots']) +\n",
    "            0.4 * safe_divide(df['away_deep'], df['home_deep']+df['away_deep'])\n",
    "        )\n",
    "    ).rename(columns={\n",
    "        'xG_away': 'xG',\n",
    "        'away_shots': 'shots',\n",
    "        'away_shotOnTarget': 'shotOnTarget',\n",
    "        'away_deep': 'deep'\n",
    "    })[team_cols]\n",
    "\n",
    "    # Combine and sort\n",
    "    df_team = pd.concat([df_home, df_away]).sort_values(['team','date']).reset_index(drop=True)\n",
    "\n",
    "    # Calculate rolling features\n",
    "    stats = ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']\n",
    "    for stat in stats:\n",
    "        df_team[f'rolling_{stat}'] = (\n",
    "            df_team.groupby('team')[stat]\n",
    "            .transform(lambda x: x.rolling(window=5, min_periods=1).mean().shift(1))\n",
    "            # Optional: fill initial NaN per team\n",
    "            .fillna(0)\n",
    "        )\n",
    "    return df_team, df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "a0d127fb",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:08.325050Z",
     "iopub.status.busy": "2025-05-06T13:18:08.324757Z",
     "iopub.status.idle": "2025-05-06T13:18:08.506529Z",
     "shell.execute_reply": "2025-05-06T13:18:08.505250Z"
    },
    "papermill": {
     "duration": 0.188244,
     "end_time": "2025-05-06T13:18:08.508105",
     "exception": false,
     "start_time": "2025-05-06T13:18:08.319861",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_13/47173307.py:9: FutureWarning: Downcasting behavior in `replace` is deprecated and will be removed in a future version. To retain the old behavior, explicitly call `result.infer_objects(copy=False)`. To opt-in to the future behavior, set `pd.set_option('future.no_silent_downcasting', True)`\n",
      "  df['result'] = pd.to_numeric(df['result'].replace({'w': 3, 'd': 1, 'l': 0}), errors='coerce')\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/core/series.py:1031: RuntimeWarning: invalid value encountered in cast\n",
      "  arr = np.asarray(values, dtype=dtype)\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/core/series.py:1031: RuntimeWarning: invalid value encountered in cast\n",
      "  arr = np.asarray(values, dtype=dtype)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>home_team</th>\n",
       "      <th>away_team</th>\n",
       "      <th>home_goals</th>\n",
       "      <th>away_goals</th>\n",
       "      <th>is_home</th>\n",
       "      <th>xG_home</th>\n",
       "      <th>xG_away</th>\n",
       "      <th>home_shots</th>\n",
       "      <th>away_shots</th>\n",
       "      <th>home_shotOnTarget</th>\n",
       "      <th>away_shotOnTarget</th>\n",
       "      <th>home_deep</th>\n",
       "      <th>away_deep</th>\n",
       "      <th>result</th>\n",
       "      <th>home_final_pos</th>\n",
       "      <th>away_final_pos</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Manchester United</td>\n",
       "      <td>Swansea</td>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1.166350</td>\n",
       "      <td>0.278076</td>\n",
       "      <td>14</td>\n",
       "      <td>5</td>\n",
       "      <td>5</td>\n",
       "      <td>4</td>\n",
       "      <td>8</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>8</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.853100</td>\n",
       "      <td>1.017060</td>\n",
       "      <td>18</td>\n",
       "      <td>10</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>12</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>0.158151</td>\n",
       "      <td>14</td>\n",
       "      <td>4</td>\n",
       "      <td>6</td>\n",
       "      <td>2</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Stoke</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0.423368</td>\n",
       "      <td>0.909774</td>\n",
       "      <td>12</td>\n",
       "      <td>7</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>9</td>\n",
       "      <td>17</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Leicester</td>\n",
       "      <td>Everton</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1.278300</td>\n",
       "      <td>0.613273</td>\n",
       "      <td>11</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>15</td>\n",
       "      <td>1</td>\n",
       "      <td>14</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        date          home_team       away_team  home_goals  away_goals  \\\n",
       "0 2014-08-16  Manchester United         Swansea           1           2   \n",
       "1 2014-08-16           West Ham       Tottenham           0           1   \n",
       "2 2014-08-16            Arsenal  Crystal Palace           2           1   \n",
       "3 2014-08-16              Stoke     Aston Villa           0           1   \n",
       "4 2014-08-16          Leicester         Everton           2           2   \n",
       "\n",
       "   is_home   xG_home   xG_away  home_shots  away_shots  home_shotOnTarget  \\\n",
       "0        1  1.166350  0.278076          14           5                  5   \n",
       "1        1  1.853100  1.017060          18          10                  4   \n",
       "2        1  1.554110  0.158151          14           4                  6   \n",
       "3        1  0.423368  0.909774          12           7                  2   \n",
       "4        1  1.278300  0.613273          11          13                  3   \n",
       "\n",
       "   away_shotOnTarget  home_deep  away_deep  result  home_final_pos  \\\n",
       "0                  4          8          2       0               4   \n",
       "1                  4          9          3       3              12   \n",
       "2                  2          9          0       3               3   \n",
       "3                  1          3          4       0               9   \n",
       "4                  3          1         15       1              14   \n",
       "\n",
       "   away_final_pos  \n",
       "0               8  \n",
       "1               5  \n",
       "2              10  \n",
       "3              17  \n",
       "4              11  "
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "team_df, match_df = preprocess_data('/kaggle/input/epl-with-labels-matchday/EPL.csv')\n",
    "team_df.groupby('team', as_index=False).head(50)\n",
    "match_df.head(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "1ee2fd97",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:08.518358Z",
     "iopub.status.busy": "2025-05-06T13:18:08.517709Z",
     "iopub.status.idle": "2025-05-06T13:18:08.523758Z",
     "shell.execute_reply": "2025-05-06T13:18:08.522899Z"
    },
    "papermill": {
     "duration": 0.012834,
     "end_time": "2025-05-06T13:18:08.525260",
     "exception": false,
     "start_time": "2025-05-06T13:18:08.512426",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "def merge(match_df, team_df):\n",
    "    # print(team_df.columns.tolist())\n",
    "    prepared_df = match_df.merge(\n",
    "        team_df[team_df['is_home']==1][['date', 'team', *[f'rolling_{stat}' for stat in ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']]]],\n",
    "        left_on=['date', 'home_team'],\n",
    "        right_on=['date', 'team'],\n",
    "        suffixes=('', '_home')\n",
    "    )\n",
    "    prepared_df = prepared_df.merge(\n",
    "        team_df[team_df['is_home']==0][['date', 'team', *[f'rolling_{stat}' for stat in ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']]]],\n",
    "        left_on=['date', 'away_team'],\n",
    "        right_on=['date', 'team'],\n",
    "        suffixes=('', '_away')\n",
    "    )\n",
    "    return prepared_df\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "6829a842",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:08.535006Z",
     "iopub.status.busy": "2025-05-06T13:18:08.534694Z",
     "iopub.status.idle": "2025-05-06T13:18:08.585852Z",
     "shell.execute_reply": "2025-05-06T13:18:08.585002Z"
    },
    "papermill": {
     "duration": 0.058266,
     "end_time": "2025-05-06T13:18:08.587879",
     "exception": false,
     "start_time": "2025-05-06T13:18:08.529613",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>team_form</th>\n",
       "      <th>xG</th>\n",
       "      <th>shots</th>\n",
       "      <th>shotOnTarget</th>\n",
       "      <th>deep</th>\n",
       "      <th>is_home</th>\n",
       "      <th>possession_proxy</th>\n",
       "      <th>final_pos</th>\n",
       "      <th>rolling_xG</th>\n",
       "      <th>rolling_shots</th>\n",
       "      <th>rolling_shotOnTarget</th>\n",
       "      <th>rolling_deep</th>\n",
       "      <th>rolling_team_form</th>\n",
       "      <th>rolling_possession_proxy</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>team</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Arsenal</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>3</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.672291</td>\n",
       "      <td>3</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Aston Villa</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>3</td>\n",
       "      <td>0.909774</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.204729</td>\n",
       "      <td>17</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Bournemouth</th>\n",
       "      <td>2015-08-08</td>\n",
       "      <td>0</td>\n",
       "      <td>0.876106</td>\n",
       "      <td>11</td>\n",
       "      <td>2</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>0.158489</td>\n",
       "      <td>16</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Brentford</th>\n",
       "      <td>2021-08-13</td>\n",
       "      <td>0</td>\n",
       "      <td>1.888180</td>\n",
       "      <td>8</td>\n",
       "      <td>3</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>0.194522</td>\n",
       "      <td>13</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Brighton</th>\n",
       "      <td>2017-08-12</td>\n",
       "      <td>3</td>\n",
       "      <td>0.276343</td>\n",
       "      <td>6</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.038670</td>\n",
       "      <td>15</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Burnley</th>\n",
       "      <td>2014-08-18</td>\n",
       "      <td>3</td>\n",
       "      <td>0.371141</td>\n",
       "      <td>9</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.044517</td>\n",
       "      <td>19</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Cardiff</th>\n",
       "      <td>2018-08-11</td>\n",
       "      <td>0</td>\n",
       "      <td>1.506930</td>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.110071</td>\n",
       "      <td>18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Chelsea</th>\n",
       "      <td>2014-08-18</td>\n",
       "      <td>0</td>\n",
       "      <td>2.129960</td>\n",
       "      <td>11</td>\n",
       "      <td>3</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>0.255483</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Crystal Palace</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>0</td>\n",
       "      <td>0.158151</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.027709</td>\n",
       "      <td>10</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Everton</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>1</td>\n",
       "      <td>0.613273</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>15</td>\n",
       "      <td>0</td>\n",
       "      <td>0.097264</td>\n",
       "      <td>11</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Fulham</th>\n",
       "      <td>2018-08-11</td>\n",
       "      <td>3</td>\n",
       "      <td>0.638076</td>\n",
       "      <td>15</td>\n",
       "      <td>6</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>0.111536</td>\n",
       "      <td>19</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Huddersfield</th>\n",
       "      <td>2017-08-12</td>\n",
       "      <td>3</td>\n",
       "      <td>1.736570</td>\n",
       "      <td>9</td>\n",
       "      <td>6</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.191147</td>\n",
       "      <td>16</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Hull</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>0</td>\n",
       "      <td>1.117570</td>\n",
       "      <td>11</td>\n",
       "      <td>4</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.111082</td>\n",
       "      <td>18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Ipswich</th>\n",
       "      <td>2024-08-17</td>\n",
       "      <td>3</td>\n",
       "      <td>0.342601</td>\n",
       "      <td>7</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.024061</td>\n",
       "      <td>18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Leeds</th>\n",
       "      <td>2020-09-12</td>\n",
       "      <td>0</td>\n",
       "      <td>0.269813</td>\n",
       "      <td>6</td>\n",
       "      <td>3</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0.023641</td>\n",
       "      <td>9</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Leicester</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>1</td>\n",
       "      <td>1.278300</td>\n",
       "      <td>11</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0.202736</td>\n",
       "      <td>14</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Liverpool</th>\n",
       "      <td>2014-08-17</td>\n",
       "      <td>3</td>\n",
       "      <td>1.331920</td>\n",
       "      <td>12</td>\n",
       "      <td>5</td>\n",
       "      <td>6</td>\n",
       "      <td>1</td>\n",
       "      <td>0.138530</td>\n",
       "      <td>6</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Luton</th>\n",
       "      <td>2023-08-12</td>\n",
       "      <td>0</td>\n",
       "      <td>1.885940</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.090476</td>\n",
       "      <td>18</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Manchester City</th>\n",
       "      <td>2014-08-17</td>\n",
       "      <td>0</td>\n",
       "      <td>1.480530</td>\n",
       "      <td>13</td>\n",
       "      <td>5</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>0.181577</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Manchester United</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>0</td>\n",
       "      <td>1.166350</td>\n",
       "      <td>14</td>\n",
       "      <td>5</td>\n",
       "      <td>8</td>\n",
       "      <td>1</td>\n",
       "      <td>0.242245</td>\n",
       "      <td>4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Middlesbrough</th>\n",
       "      <td>2016-08-13</td>\n",
       "      <td>1</td>\n",
       "      <td>1.805230</td>\n",
       "      <td>12</td>\n",
       "      <td>2</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.236405</td>\n",
       "      <td>19</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Newcastle United</th>\n",
       "      <td>2014-08-17</td>\n",
       "      <td>3</td>\n",
       "      <td>0.965583</td>\n",
       "      <td>12</td>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>1</td>\n",
       "      <td>0.118423</td>\n",
       "      <td>15</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Norwich</th>\n",
       "      <td>2015-08-08</td>\n",
       "      <td>3</td>\n",
       "      <td>1.130760</td>\n",
       "      <td>17</td>\n",
       "      <td>6</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>0.104684</td>\n",
       "      <td>19</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Nottingham Forest</th>\n",
       "      <td>2022-08-06</td>\n",
       "      <td>0</td>\n",
       "      <td>0.235825</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0.033771</td>\n",
       "      <td>16</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Queens Park Rangers</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>3</td>\n",
       "      <td>1.900670</td>\n",
       "      <td>19</td>\n",
       "      <td>6</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0.188918</td>\n",
       "      <td>20</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Sheffield United</th>\n",
       "      <td>2019-08-10</td>\n",
       "      <td>1</td>\n",
       "      <td>1.598640</td>\n",
       "      <td>8</td>\n",
       "      <td>3</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0.163147</td>\n",
       "      <td>9</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Southampton</th>\n",
       "      <td>2014-08-17</td>\n",
       "      <td>0</td>\n",
       "      <td>1.552480</td>\n",
       "      <td>12</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "      <td>0.161470</td>\n",
       "      <td>7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Stoke</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>0</td>\n",
       "      <td>0.423368</td>\n",
       "      <td>12</td>\n",
       "      <td>2</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>0.095271</td>\n",
       "      <td>9</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Sunderland</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>1</td>\n",
       "      <td>0.991901</td>\n",
       "      <td>7</td>\n",
       "      <td>2</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0.111227</td>\n",
       "      <td>16</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Swansea</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>3</td>\n",
       "      <td>0.278076</td>\n",
       "      <td>5</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0.057755</td>\n",
       "      <td>8</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Tottenham</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>0</td>\n",
       "      <td>1.017060</td>\n",
       "      <td>10</td>\n",
       "      <td>4</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0.106307</td>\n",
       "      <td>5</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Watford</th>\n",
       "      <td>2015-08-08</td>\n",
       "      <td>1</td>\n",
       "      <td>0.557892</td>\n",
       "      <td>11</td>\n",
       "      <td>5</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.144019</td>\n",
       "      <td>13</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>West Bromwich Albion</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>1</td>\n",
       "      <td>1.683430</td>\n",
       "      <td>10</td>\n",
       "      <td>5</td>\n",
       "      <td>6</td>\n",
       "      <td>1</td>\n",
       "      <td>0.188773</td>\n",
       "      <td>13</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>West Ham</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>3</td>\n",
       "      <td>1.853100</td>\n",
       "      <td>18</td>\n",
       "      <td>4</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.193693</td>\n",
       "      <td>12</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Wolverhampton Wanderers</th>\n",
       "      <td>2018-08-11</td>\n",
       "      <td>1</td>\n",
       "      <td>0.891038</td>\n",
       "      <td>11</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.166402</td>\n",
       "      <td>7</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                              date  team_form        xG  shots  shotOnTarget  \\\n",
       "team                                                                           \n",
       "Arsenal                 2014-08-16          3  1.554110     14             6   \n",
       "Aston Villa             2014-08-16          3  0.909774      7             1   \n",
       "Bournemouth             2015-08-08          0  0.876106     11             2   \n",
       "Brentford               2021-08-13          0  1.888180      8             3   \n",
       "Brighton                2017-08-12          3  0.276343      6             2   \n",
       "Burnley                 2014-08-18          3  0.371141      9             2   \n",
       "Cardiff                 2018-08-11          0  1.506930     10             1   \n",
       "Chelsea                 2014-08-18          0  2.129960     11             3   \n",
       "Crystal Palace          2014-08-16          0  0.158151      4             2   \n",
       "Everton                 2014-08-16          1  0.613273     13             3   \n",
       "Fulham                  2018-08-11          3  0.638076     15             6   \n",
       "Huddersfield            2017-08-12          3  1.736570      9             6   \n",
       "Hull                    2014-08-16          0  1.117570     11             4   \n",
       "Ipswich                 2024-08-17          3  0.342601      7             2   \n",
       "Leeds                   2020-09-12          0  0.269813      6             3   \n",
       "Leicester               2014-08-16          1  1.278300     11             3   \n",
       "Liverpool               2014-08-17          3  1.331920     12             5   \n",
       "Luton                   2023-08-12          0  1.885940      9             3   \n",
       "Manchester City         2014-08-17          0  1.480530     13             5   \n",
       "Manchester United       2014-08-16          0  1.166350     14             5   \n",
       "Middlesbrough           2016-08-13          1  1.805230     12             2   \n",
       "Newcastle United        2014-08-17          3  0.965583     12             0   \n",
       "Norwich                 2015-08-08          3  1.130760     17             6   \n",
       "Nottingham Forest       2022-08-06          0  0.235825      5             0   \n",
       "Queens Park Rangers     2014-08-16          3  1.900670     19             6   \n",
       "Sheffield United        2019-08-10          1  1.598640      8             3   \n",
       "Southampton             2014-08-17          0  1.552480     12             6   \n",
       "Stoke                   2014-08-16          0  0.423368     12             2   \n",
       "Sunderland              2014-08-16          1  0.991901      7             2   \n",
       "Swansea                 2014-08-16          3  0.278076      5             4   \n",
       "Tottenham               2014-08-16          0  1.017060     10             4   \n",
       "Watford                 2015-08-08          1  0.557892     11             5   \n",
       "West Bromwich Albion    2014-08-16          1  1.683430     10             5   \n",
       "West Ham                2014-08-16          3  1.853100     18             4   \n",
       "Wolverhampton Wanderers 2018-08-11          1  0.891038     11             4   \n",
       "\n",
       "                         deep  is_home  possession_proxy  final_pos  \\\n",
       "team                                                                  \n",
       "Arsenal                     9        1          0.672291          3   \n",
       "Aston Villa                 4        0          0.204729         17   \n",
       "Bournemouth                11        1          0.158489         16   \n",
       "Brentford                   7        1          0.194522         13   \n",
       "Brighton                    2        1          0.038670         15   \n",
       "Burnley                     2        1          0.044517         19   \n",
       "Cardiff                     5        0          0.110071         18   \n",
       "Chelsea                    10        0          0.255483          1   \n",
       "Crystal Palace              0        0          0.027709         10   \n",
       "Everton                    15        0          0.097264         11   \n",
       "Fulham                      3        1          0.111536         19   \n",
       "Huddersfield                5        0          0.191147         16   \n",
       "Hull                        5        0          0.111082         18   \n",
       "Ipswich                     2        1          0.024061         18   \n",
       "Leeds                       2        0          0.023641          9   \n",
       "Leicester                   1        1          0.202736         14   \n",
       "Liverpool                   6        1          0.138530          6   \n",
       "Luton                       5        0          0.090476         18   \n",
       "Manchester City             9        0          0.181577          2   \n",
       "Manchester United           8        1          0.242245          4   \n",
       "Middlesbrough               4        1          0.236405         19   \n",
       "Newcastle United            6        1          0.118423         15   \n",
       "Norwich                     5        1          0.104684         19   \n",
       "Nottingham Forest           2        0          0.033771         16   \n",
       "Queens Park Rangers         1        1          0.188918         20   \n",
       "Sheffield United            6        0          0.163147          9   \n",
       "Southampton                 9        0          0.161470          7   \n",
       "Stoke                       3        1          0.095271          9   \n",
       "Sunderland                  3        0          0.111227         16   \n",
       "Swansea                     2        0          0.057755          8   \n",
       "Tottenham                   3        0          0.106307          5   \n",
       "Watford                     4        0          0.144019         13   \n",
       "West Bromwich Albion        6        1          0.188773         13   \n",
       "West Ham                    9        1          0.193693         12   \n",
       "Wolverhampton Wanderers     4        1          0.166402          7   \n",
       "\n",
       "                         rolling_xG  rolling_shots  rolling_shotOnTarget  \\\n",
       "team                                                                       \n",
       "Arsenal                         0.0            0.0                   0.0   \n",
       "Aston Villa                     0.0            0.0                   0.0   \n",
       "Bournemouth                     0.0            0.0                   0.0   \n",
       "Brentford                       0.0            0.0                   0.0   \n",
       "Brighton                        0.0            0.0                   0.0   \n",
       "Burnley                         0.0            0.0                   0.0   \n",
       "Cardiff                         0.0            0.0                   0.0   \n",
       "Chelsea                         0.0            0.0                   0.0   \n",
       "Crystal Palace                  0.0            0.0                   0.0   \n",
       "Everton                         0.0            0.0                   0.0   \n",
       "Fulham                          0.0            0.0                   0.0   \n",
       "Huddersfield                    0.0            0.0                   0.0   \n",
       "Hull                            0.0            0.0                   0.0   \n",
       "Ipswich                         0.0            0.0                   0.0   \n",
       "Leeds                           0.0            0.0                   0.0   \n",
       "Leicester                       0.0            0.0                   0.0   \n",
       "Liverpool                       0.0            0.0                   0.0   \n",
       "Luton                           0.0            0.0                   0.0   \n",
       "Manchester City                 0.0            0.0                   0.0   \n",
       "Manchester United               0.0            0.0                   0.0   \n",
       "Middlesbrough                   0.0            0.0                   0.0   \n",
       "Newcastle United                0.0            0.0                   0.0   \n",
       "Norwich                         0.0            0.0                   0.0   \n",
       "Nottingham Forest               0.0            0.0                   0.0   \n",
       "Queens Park Rangers             0.0            0.0                   0.0   \n",
       "Sheffield United                0.0            0.0                   0.0   \n",
       "Southampton                     0.0            0.0                   0.0   \n",
       "Stoke                           0.0            0.0                   0.0   \n",
       "Sunderland                      0.0            0.0                   0.0   \n",
       "Swansea                         0.0            0.0                   0.0   \n",
       "Tottenham                       0.0            0.0                   0.0   \n",
       "Watford                         0.0            0.0                   0.0   \n",
       "West Bromwich Albion            0.0            0.0                   0.0   \n",
       "West Ham                        0.0            0.0                   0.0   \n",
       "Wolverhampton Wanderers         0.0            0.0                   0.0   \n",
       "\n",
       "                         rolling_deep  rolling_team_form  \\\n",
       "team                                                       \n",
       "Arsenal                           0.0                0.0   \n",
       "Aston Villa                       0.0                0.0   \n",
       "Bournemouth                       0.0                0.0   \n",
       "Brentford                         0.0                0.0   \n",
       "Brighton                          0.0                0.0   \n",
       "Burnley                           0.0                0.0   \n",
       "Cardiff                           0.0                0.0   \n",
       "Chelsea                           0.0                0.0   \n",
       "Crystal Palace                    0.0                0.0   \n",
       "Everton                           0.0                0.0   \n",
       "Fulham                            0.0                0.0   \n",
       "Huddersfield                      0.0                0.0   \n",
       "Hull                              0.0                0.0   \n",
       "Ipswich                           0.0                0.0   \n",
       "Leeds                             0.0                0.0   \n",
       "Leicester                         0.0                0.0   \n",
       "Liverpool                         0.0                0.0   \n",
       "Luton                             0.0                0.0   \n",
       "Manchester City                   0.0                0.0   \n",
       "Manchester United                 0.0                0.0   \n",
       "Middlesbrough                     0.0                0.0   \n",
       "Newcastle United                  0.0                0.0   \n",
       "Norwich                           0.0                0.0   \n",
       "Nottingham Forest                 0.0                0.0   \n",
       "Queens Park Rangers               0.0                0.0   \n",
       "Sheffield United                  0.0                0.0   \n",
       "Southampton                       0.0                0.0   \n",
       "Stoke                             0.0                0.0   \n",
       "Sunderland                        0.0                0.0   \n",
       "Swansea                           0.0                0.0   \n",
       "Tottenham                         0.0                0.0   \n",
       "Watford                           0.0                0.0   \n",
       "West Bromwich Albion              0.0                0.0   \n",
       "West Ham                          0.0                0.0   \n",
       "Wolverhampton Wanderers           0.0                0.0   \n",
       "\n",
       "                         rolling_possession_proxy  \n",
       "team                                               \n",
       "Arsenal                                       0.0  \n",
       "Aston Villa                                   0.0  \n",
       "Bournemouth                                   0.0  \n",
       "Brentford                                     0.0  \n",
       "Brighton                                      0.0  \n",
       "Burnley                                       0.0  \n",
       "Cardiff                                       0.0  \n",
       "Chelsea                                       0.0  \n",
       "Crystal Palace                                0.0  \n",
       "Everton                                       0.0  \n",
       "Fulham                                        0.0  \n",
       "Huddersfield                                  0.0  \n",
       "Hull                                          0.0  \n",
       "Ipswich                                       0.0  \n",
       "Leeds                                         0.0  \n",
       "Leicester                                     0.0  \n",
       "Liverpool                                     0.0  \n",
       "Luton                                         0.0  \n",
       "Manchester City                               0.0  \n",
       "Manchester United                             0.0  \n",
       "Middlesbrough                                 0.0  \n",
       "Newcastle United                              0.0  \n",
       "Norwich                                       0.0  \n",
       "Nottingham Forest                             0.0  \n",
       "Queens Park Rangers                           0.0  \n",
       "Sheffield United                              0.0  \n",
       "Southampton                                   0.0  \n",
       "Stoke                                         0.0  \n",
       "Sunderland                                    0.0  \n",
       "Swansea                                       0.0  \n",
       "Tottenham                                     0.0  \n",
       "Watford                                       0.0  \n",
       "West Bromwich Albion                          0.0  \n",
       "West Ham                                      0.0  \n",
       "Wolverhampton Wanderers                       0.0  "
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "prepared_df = merge(match_df, team_df)\n",
    "team_df.groupby('team').first()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "a5bc8a43",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:08.599562Z",
     "iopub.status.busy": "2025-05-06T13:18:08.599264Z",
     "iopub.status.idle": "2025-05-06T13:18:09.034085Z",
     "shell.execute_reply": "2025-05-06T13:18:09.033140Z"
    },
    "papermill": {
     "duration": 0.442177,
     "end_time": "2025-05-06T13:18:09.035409",
     "exception": false,
     "start_time": "2025-05-06T13:18:08.593232",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>club</th>\n",
       "      <th>country</th>\n",
       "      <th>elo</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>191539</th>\n",
       "      <td>2020-01-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1840.87</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>191946</th>\n",
       "      <td>2020-01-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1826.59</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>192352</th>\n",
       "      <td>2020-02-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1826.54</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>192758</th>\n",
       "      <td>2020-02-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1842.44</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>193164</th>\n",
       "      <td>2020-03-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1828.44</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>193570</th>\n",
       "      <td>2020-03-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1798.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>193976</th>\n",
       "      <td>2020-04-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1798.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>194382</th>\n",
       "      <td>2020-04-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1798.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>194788</th>\n",
       "      <td>2020-05-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1798.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>195194</th>\n",
       "      <td>2020-05-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1798.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>195600</th>\n",
       "      <td>2020-06-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1798.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>196006</th>\n",
       "      <td>2020-06-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1798.41</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>196423</th>\n",
       "      <td>2020-07-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1803.88</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>196838</th>\n",
       "      <td>2020-07-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1799.15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>197252</th>\n",
       "      <td>2020-08-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1816.75</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>197666</th>\n",
       "      <td>2020-08-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1817.36</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>198079</th>\n",
       "      <td>2020-09-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1807.71</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>198490</th>\n",
       "      <td>2020-09-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1796.34</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>198903</th>\n",
       "      <td>2020-10-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1806.49</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>199315</th>\n",
       "      <td>2020-10-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1831.92</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>199727</th>\n",
       "      <td>2020-11-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1841.13</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>200139</th>\n",
       "      <td>2020-11-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1856.59</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>200551</th>\n",
       "      <td>2020-12-01</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1873.09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>200963</th>\n",
       "      <td>2020-12-15</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>ENG</td>\n",
       "      <td>1867.27</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             date       club country      elo\n",
       "191539 2020-01-01  Tottenham     ENG  1840.87\n",
       "191946 2020-01-15  Tottenham     ENG  1826.59\n",
       "192352 2020-02-01  Tottenham     ENG  1826.54\n",
       "192758 2020-02-15  Tottenham     ENG  1842.44\n",
       "193164 2020-03-01  Tottenham     ENG  1828.44\n",
       "193570 2020-03-15  Tottenham     ENG  1798.41\n",
       "193976 2020-04-01  Tottenham     ENG  1798.41\n",
       "194382 2020-04-15  Tottenham     ENG  1798.41\n",
       "194788 2020-05-01  Tottenham     ENG  1798.41\n",
       "195194 2020-05-15  Tottenham     ENG  1798.41\n",
       "195600 2020-06-01  Tottenham     ENG  1798.41\n",
       "196006 2020-06-15  Tottenham     ENG  1798.41\n",
       "196423 2020-07-01  Tottenham     ENG  1803.88\n",
       "196838 2020-07-15  Tottenham     ENG  1799.15\n",
       "197252 2020-08-01  Tottenham     ENG  1816.75\n",
       "197666 2020-08-15  Tottenham     ENG  1817.36\n",
       "198079 2020-09-01  Tottenham     ENG  1807.71\n",
       "198490 2020-09-15  Tottenham     ENG  1796.34\n",
       "198903 2020-10-01  Tottenham     ENG  1806.49\n",
       "199315 2020-10-15  Tottenham     ENG  1831.92\n",
       "199727 2020-11-01  Tottenham     ENG  1841.13\n",
       "200139 2020-11-15  Tottenham     ENG  1856.59\n",
       "200551 2020-12-01  Tottenham     ENG  1873.09\n",
       "200963 2020-12-15  Tottenham     ENG  1867.27"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "elo_df = pd.read_csv('/kaggle/input/club-football-match-data-2000-2025/EloRatings.csv')\n",
    "elo_df['date'] = pd.to_datetime(elo_df['date'])  # Convert first if needed\n",
    "elo_df[\n",
    "    (elo_df['country'] == \"ENG\") & \n",
    "    (elo_df['date'].dt.year == 2020) & (elo_df['club'] == \"Tottenham\")\n",
    "]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "1626d569",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:09.047620Z",
     "iopub.status.busy": "2025-05-06T13:18:09.047306Z",
     "iopub.status.idle": "2025-05-06T13:18:10.722256Z",
     "shell.execute_reply": "2025-05-06T13:18:10.721389Z"
    },
    "papermill": {
     "duration": 1.682807,
     "end_time": "2025-05-06T13:18:10.723775",
     "exception": false,
     "start_time": "2025-05-06T13:18:09.040968",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from scipy.special import expit as sigmoid\n",
    "\n",
    "# Configuration\n",
    "k = 400  # Elo rating scale factor\n",
    "elo_baseline = 1500  # Baseline Elo rating\n",
    "stats_cols = ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']\n",
    "# 1. Prepare the base statistics (using year-specific means)\n",
    "def get_year_specific_base_stats(year):\n",
    "    year_mask = (team_df['date'].dt.year == year)\n",
    "    return {\n",
    "        'xG': team_df.loc[year_mask, 'rolling_xG'].mean(),\n",
    "        'shots': team_df.loc[year_mask, 'rolling_shots'].mean(),\n",
    "        'shotOnTarget': team_df.loc[year_mask, 'rolling_shotOnTarget'].mean(),\n",
    "        'deep': team_df.loc[year_mask, 'rolling_deep'].mean(),\n",
    "        'team_form': team_df.loc[year_mask, 'rolling_team_form'].mean(),\n",
    "        'possession_proxy': team_df.loc[year_mask, 'rolling_possession_proxy'].mean()\n",
    "    }\n",
    "\n",
    "# 2. Define the imputation function\n",
    "def elo_impute(base_stat, elo_team, k=400, elo_baseline=1500):\n",
    "    return base_stat * (1 + sigmoid((elo_team - elo_baseline) / k))\n",
    "\n",
    "# 3. Process each row that needs imputation\n",
    "for idx, row in team_df.iterrows():\n",
    "    if all(row[f'rolling_{col}'] == 0 for col in stats_cols):  # Check if any rolling stat is 0\n",
    "        year = row['date'].year\n",
    "        team = row['team']\n",
    "        \n",
    "        # Get year-specific base stats\n",
    "        base_stats = get_year_specific_base_stats(year)\n",
    "        \n",
    "       # Find team's Elo rating (most recent before current date)\n",
    "        filtered_elo = elo_df[\n",
    "            (elo_df['club'] == team) & \n",
    "            (elo_df['date'] <= row['date'])\n",
    "        ].sort_values('date', ascending=False)\n",
    "\n",
    "        # Use baseline if no past Elo found\n",
    "        team_elo = filtered_elo['elo'].values[0] if not filtered_elo.empty else elo_baseline\n",
    "        \n",
    "        # Impute each stat\n",
    "        for stat in stats_cols:\n",
    "            if row[f'rolling_{stat}'] == 0:\n",
    "                base_stat = base_stats[stat]\n",
    "                team_df.at[idx, f'rolling_{stat}'] = elo_impute(base_stat, team_elo, k, elo_baseline)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "29aa6daf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:10.736291Z",
     "iopub.status.busy": "2025-05-06T13:18:10.735821Z",
     "iopub.status.idle": "2025-05-06T13:18:10.761251Z",
     "shell.execute_reply": "2025-05-06T13:18:10.760395Z"
    },
    "papermill": {
     "duration": 0.033346,
     "end_time": "2025-05-06T13:18:10.762817",
     "exception": false,
     "start_time": "2025-05-06T13:18:10.729471",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>team</th>\n",
       "      <th>team_form</th>\n",
       "      <th>xG</th>\n",
       "      <th>shots</th>\n",
       "      <th>shotOnTarget</th>\n",
       "      <th>deep</th>\n",
       "      <th>is_home</th>\n",
       "      <th>possession_proxy</th>\n",
       "      <th>final_pos</th>\n",
       "      <th>rolling_xG</th>\n",
       "      <th>rolling_shots</th>\n",
       "      <th>rolling_shotOnTarget</th>\n",
       "      <th>rolling_deep</th>\n",
       "      <th>rolling_team_form</th>\n",
       "      <th>rolling_possession_proxy</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.672291</td>\n",
       "      <td>3</td>\n",
       "      <td>2.001291</td>\n",
       "      <td>20.793296</td>\n",
       "      <td>6.554425</td>\n",
       "      <td>9.948848</td>\n",
       "      <td>2.209085</td>\n",
       "      <td>0.261765</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.433550</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0.155379</td>\n",
       "      <td>3</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.672291</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2014-08-31</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.296490</td>\n",
       "      <td>24</td>\n",
       "      <td>6</td>\n",
       "      <td>13</td>\n",
       "      <td>0</td>\n",
       "      <td>0.221795</td>\n",
       "      <td>3</td>\n",
       "      <td>1.493830</td>\n",
       "      <td>13.500000</td>\n",
       "      <td>4.500000</td>\n",
       "      <td>8.500000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.413835</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2014-09-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.078040</td>\n",
       "      <td>15</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.142124</td>\n",
       "      <td>3</td>\n",
       "      <td>1.761383</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>1.666667</td>\n",
       "      <td>0.349822</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2014-09-20</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.362240</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>0.603193</td>\n",
       "      <td>3</td>\n",
       "      <td>1.840548</td>\n",
       "      <td>16.500000</td>\n",
       "      <td>5.250000</td>\n",
       "      <td>9.750000</td>\n",
       "      <td>1.500000</td>\n",
       "      <td>0.297897</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2014-09-27</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.264700</td>\n",
       "      <td>16</td>\n",
       "      <td>6</td>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>0.195750</td>\n",
       "      <td>3</td>\n",
       "      <td>1.744886</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>9.200000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.358956</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2014-10-05</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>0.330699</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0.057237</td>\n",
       "      <td>3</td>\n",
       "      <td>1.687004</td>\n",
       "      <td>15.400000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>9.400000</td>\n",
       "      <td>0.800000</td>\n",
       "      <td>0.263648</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2014-10-18</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.148450</td>\n",
       "      <td>25</td>\n",
       "      <td>9</td>\n",
       "      <td>17</td>\n",
       "      <td>1</td>\n",
       "      <td>0.638671</td>\n",
       "      <td>3</td>\n",
       "      <td>1.466434</td>\n",
       "      <td>14.800000</td>\n",
       "      <td>4.200000</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>0.600000</td>\n",
       "      <td>0.244020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2014-10-25</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.470810</td>\n",
       "      <td>15</td>\n",
       "      <td>5</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>0.230739</td>\n",
       "      <td>3</td>\n",
       "      <td>1.436826</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>9.800000</td>\n",
       "      <td>0.600000</td>\n",
       "      <td>0.327395</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2014-11-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>4.329800</td>\n",
       "      <td>32</td>\n",
       "      <td>12</td>\n",
       "      <td>19</td>\n",
       "      <td>1</td>\n",
       "      <td>0.259060</td>\n",
       "      <td>3</td>\n",
       "      <td>1.315380</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>4.600000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>0.400000</td>\n",
       "      <td>0.345118</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2014-11-09</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.776990</td>\n",
       "      <td>12</td>\n",
       "      <td>4</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>0.232036</td>\n",
       "      <td>3</td>\n",
       "      <td>1.908892</td>\n",
       "      <td>19.600000</td>\n",
       "      <td>6.400000</td>\n",
       "      <td>12.400000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.276291</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2014-11-22</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.001930</td>\n",
       "      <td>23</td>\n",
       "      <td>9</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>0.183046</td>\n",
       "      <td>3</td>\n",
       "      <td>2.011350</td>\n",
       "      <td>18.800000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>13.200000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.283549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2014-11-29</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.056030</td>\n",
       "      <td>17</td>\n",
       "      <td>5</td>\n",
       "      <td>12</td>\n",
       "      <td>0</td>\n",
       "      <td>0.231030</td>\n",
       "      <td>3</td>\n",
       "      <td>2.345596</td>\n",
       "      <td>21.400000</td>\n",
       "      <td>7.800000</td>\n",
       "      <td>14.400000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.308710</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2014-12-03</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.373320</td>\n",
       "      <td>19</td>\n",
       "      <td>8</td>\n",
       "      <td>13</td>\n",
       "      <td>1</td>\n",
       "      <td>0.241824</td>\n",
       "      <td>3</td>\n",
       "      <td>2.127112</td>\n",
       "      <td>19.800000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>13.400000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.227182</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2014-12-06</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.020730</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0.133992</td>\n",
       "      <td>3</td>\n",
       "      <td>2.307614</td>\n",
       "      <td>20.600000</td>\n",
       "      <td>7.600000</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.229399</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2014-12-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.388190</td>\n",
       "      <td>17</td>\n",
       "      <td>4</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>0.215349</td>\n",
       "      <td>3</td>\n",
       "      <td>1.845800</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>6.400000</td>\n",
       "      <td>11.400000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.204385</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2014-12-21</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>0.754219</td>\n",
       "      <td>7</td>\n",
       "      <td>3</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0.109159</td>\n",
       "      <td>3</td>\n",
       "      <td>1.968040</td>\n",
       "      <td>18.000000</td>\n",
       "      <td>6.400000</td>\n",
       "      <td>10.800000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.201048</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2014-12-26</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.138880</td>\n",
       "      <td>15</td>\n",
       "      <td>5</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>0.191176</td>\n",
       "      <td>3</td>\n",
       "      <td>1.718498</td>\n",
       "      <td>14.800000</td>\n",
       "      <td>5.200000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.186271</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2014-12-28</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>3.358860</td>\n",
       "      <td>21</td>\n",
       "      <td>7</td>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>0.225565</td>\n",
       "      <td>3</td>\n",
       "      <td>1.935068</td>\n",
       "      <td>14.400000</td>\n",
       "      <td>5.200000</td>\n",
       "      <td>9.800000</td>\n",
       "      <td>2.600000</td>\n",
       "      <td>0.178300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>0.849285</td>\n",
       "      <td>11</td>\n",
       "      <td>6</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.078066</td>\n",
       "      <td>3</td>\n",
       "      <td>2.132176</td>\n",
       "      <td>14.800000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>8.600000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.175048</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>2015-01-11</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.268890</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>0.255191</td>\n",
       "      <td>3</td>\n",
       "      <td>1.897887</td>\n",
       "      <td>14.200000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>8.200000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.163863</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>2015-01-18</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.494760</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.218030</td>\n",
       "      <td>3</td>\n",
       "      <td>1.874027</td>\n",
       "      <td>13.600000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.171832</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>2015-02-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.358050</td>\n",
       "      <td>13</td>\n",
       "      <td>8</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>0.230236</td>\n",
       "      <td>3</td>\n",
       "      <td>2.022135</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>6.200000</td>\n",
       "      <td>2.400000</td>\n",
       "      <td>0.193606</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>2015-02-07</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>0.834136</td>\n",
       "      <td>7</td>\n",
       "      <td>3</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0.118624</td>\n",
       "      <td>3</td>\n",
       "      <td>2.065969</td>\n",
       "      <td>13.600000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>2.400000</td>\n",
       "      <td>0.201418</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>2015-02-10</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.770950</td>\n",
       "      <td>17</td>\n",
       "      <td>7</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>0.206665</td>\n",
       "      <td>3</td>\n",
       "      <td>1.561024</td>\n",
       "      <td>10.800000</td>\n",
       "      <td>5.200000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.180029</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>2015-02-21</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.080540</td>\n",
       "      <td>12</td>\n",
       "      <td>4</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.143667</td>\n",
       "      <td>3</td>\n",
       "      <td>1.745357</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.205749</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>2015-03-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.392980</td>\n",
       "      <td>17</td>\n",
       "      <td>4</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>0.237333</td>\n",
       "      <td>3</td>\n",
       "      <td>1.707687</td>\n",
       "      <td>11.600000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>2.400000</td>\n",
       "      <td>0.183444</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>2015-03-04</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.165100</td>\n",
       "      <td>20</td>\n",
       "      <td>9</td>\n",
       "      <td>15</td>\n",
       "      <td>0</td>\n",
       "      <td>0.261491</td>\n",
       "      <td>3</td>\n",
       "      <td>1.687331</td>\n",
       "      <td>13.200000</td>\n",
       "      <td>5.200000</td>\n",
       "      <td>5.600000</td>\n",
       "      <td>2.400000</td>\n",
       "      <td>0.187305</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>2015-03-14</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>3.196190</td>\n",
       "      <td>19</td>\n",
       "      <td>9</td>\n",
       "      <td>23</td>\n",
       "      <td>1</td>\n",
       "      <td>0.260959</td>\n",
       "      <td>3</td>\n",
       "      <td>1.648741</td>\n",
       "      <td>14.600000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>7.600000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.193556</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>2015-03-21</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>0.754782</td>\n",
       "      <td>7</td>\n",
       "      <td>3</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>0.128540</td>\n",
       "      <td>3</td>\n",
       "      <td>2.121152</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>6.600000</td>\n",
       "      <td>11.000000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.222023</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>2015-04-04</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.456720</td>\n",
       "      <td>16</td>\n",
       "      <td>10</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>0.163624</td>\n",
       "      <td>3</td>\n",
       "      <td>1.917918</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>5.800000</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.206398</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>2015-04-11</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.210960</td>\n",
       "      <td>17</td>\n",
       "      <td>5</td>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>0.194465</td>\n",
       "      <td>3</td>\n",
       "      <td>1.793154</td>\n",
       "      <td>15.800000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.210389</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>2015-04-26</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.074820</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>0.167233</td>\n",
       "      <td>3</td>\n",
       "      <td>1.756750</td>\n",
       "      <td>15.800000</td>\n",
       "      <td>7.200000</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.201816</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>2015-05-04</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.949380</td>\n",
       "      <td>22</td>\n",
       "      <td>9</td>\n",
       "      <td>18</td>\n",
       "      <td>0</td>\n",
       "      <td>0.658409</td>\n",
       "      <td>3</td>\n",
       "      <td>1.538694</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>5.600000</td>\n",
       "      <td>11.000000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.182964</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>2015-05-11</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.883640</td>\n",
       "      <td>23</td>\n",
       "      <td>9</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>0.653311</td>\n",
       "      <td>3</td>\n",
       "      <td>1.489332</td>\n",
       "      <td>14.600000</td>\n",
       "      <td>5.600000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>0.800000</td>\n",
       "      <td>0.262454</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>2015-05-17</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.068140</td>\n",
       "      <td>5</td>\n",
       "      <td>3</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0.179685</td>\n",
       "      <td>3</td>\n",
       "      <td>1.715104</td>\n",
       "      <td>17.800000</td>\n",
       "      <td>6.800000</td>\n",
       "      <td>10.400000</td>\n",
       "      <td>0.800000</td>\n",
       "      <td>0.367408</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>2015-05-20</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.689090</td>\n",
       "      <td>28</td>\n",
       "      <td>8</td>\n",
       "      <td>25</td>\n",
       "      <td>1</td>\n",
       "      <td>0.158806</td>\n",
       "      <td>3</td>\n",
       "      <td>1.637388</td>\n",
       "      <td>15.600000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>10.600000</td>\n",
       "      <td>0.400000</td>\n",
       "      <td>0.370621</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>2015-05-24</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>3.166140</td>\n",
       "      <td>24</td>\n",
       "      <td>13</td>\n",
       "      <td>24</td>\n",
       "      <td>1</td>\n",
       "      <td>0.254293</td>\n",
       "      <td>3</td>\n",
       "      <td>1.733014</td>\n",
       "      <td>17.800000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>14.200000</td>\n",
       "      <td>0.600000</td>\n",
       "      <td>0.363489</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38</th>\n",
       "      <td>2015-08-09</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.331660</td>\n",
       "      <td>22</td>\n",
       "      <td>6</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>0.613907</td>\n",
       "      <td>2</td>\n",
       "      <td>2.151278</td>\n",
       "      <td>20.400000</td>\n",
       "      <td>8.400000</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.380901</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39</th>\n",
       "      <td>2015-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.055420</td>\n",
       "      <td>20</td>\n",
       "      <td>7</td>\n",
       "      <td>15</td>\n",
       "      <td>0</td>\n",
       "      <td>0.204211</td>\n",
       "      <td>2</td>\n",
       "      <td>1.827734</td>\n",
       "      <td>20.400000</td>\n",
       "      <td>7.800000</td>\n",
       "      <td>15.600000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.372000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40</th>\n",
       "      <td>2015-08-24</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.837550</td>\n",
       "      <td>19</td>\n",
       "      <td>5</td>\n",
       "      <td>14</td>\n",
       "      <td>1</td>\n",
       "      <td>0.176145</td>\n",
       "      <td>2</td>\n",
       "      <td>1.862090</td>\n",
       "      <td>19.800000</td>\n",
       "      <td>7.400000</td>\n",
       "      <td>16.200000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.282180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41</th>\n",
       "      <td>2015-08-29</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.339480</td>\n",
       "      <td>22</td>\n",
       "      <td>9</td>\n",
       "      <td>15</td>\n",
       "      <td>0</td>\n",
       "      <td>0.695956</td>\n",
       "      <td>2</td>\n",
       "      <td>2.015972</td>\n",
       "      <td>22.600000</td>\n",
       "      <td>7.800000</td>\n",
       "      <td>17.800000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.281472</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>42</th>\n",
       "      <td>2015-09-12</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>4.426840</td>\n",
       "      <td>29</td>\n",
       "      <td>12</td>\n",
       "      <td>20</td>\n",
       "      <td>1</td>\n",
       "      <td>0.287574</td>\n",
       "      <td>2</td>\n",
       "      <td>2.146050</td>\n",
       "      <td>21.400000</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>15.800000</td>\n",
       "      <td>0.800000</td>\n",
       "      <td>0.388902</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>43</th>\n",
       "      <td>2015-09-19</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>0.775312</td>\n",
       "      <td>9</td>\n",
       "      <td>2</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.081784</td>\n",
       "      <td>2</td>\n",
       "      <td>2.398190</td>\n",
       "      <td>22.400000</td>\n",
       "      <td>7.800000</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>0.800000</td>\n",
       "      <td>0.395559</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>44</th>\n",
       "      <td>2015-09-26</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>3.896230</td>\n",
       "      <td>27</td>\n",
       "      <td>12</td>\n",
       "      <td>17</td>\n",
       "      <td>0</td>\n",
       "      <td>0.221318</td>\n",
       "      <td>2</td>\n",
       "      <td>2.286920</td>\n",
       "      <td>19.800000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>13.800000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.289134</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>45</th>\n",
       "      <td>2015-10-04</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.169520</td>\n",
       "      <td>12</td>\n",
       "      <td>5</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>0.202819</td>\n",
       "      <td>2</td>\n",
       "      <td>2.655082</td>\n",
       "      <td>21.200000</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>14.200000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.292555</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>46</th>\n",
       "      <td>2015-10-17</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.690460</td>\n",
       "      <td>17</td>\n",
       "      <td>6</td>\n",
       "      <td>16</td>\n",
       "      <td>0</td>\n",
       "      <td>0.274047</td>\n",
       "      <td>2</td>\n",
       "      <td>2.721476</td>\n",
       "      <td>19.800000</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>13.800000</td>\n",
       "      <td>2.400000</td>\n",
       "      <td>0.297890</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47</th>\n",
       "      <td>2015-10-24</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.557540</td>\n",
       "      <td>20</td>\n",
       "      <td>5</td>\n",
       "      <td>19</td>\n",
       "      <td>1</td>\n",
       "      <td>0.261814</td>\n",
       "      <td>2</td>\n",
       "      <td>2.791672</td>\n",
       "      <td>18.800000</td>\n",
       "      <td>7.400000</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>2.400000</td>\n",
       "      <td>0.213509</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>48</th>\n",
       "      <td>2015-10-31</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.176570</td>\n",
       "      <td>14</td>\n",
       "      <td>5</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.267500</td>\n",
       "      <td>2</td>\n",
       "      <td>2.417812</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>13.800000</td>\n",
       "      <td>2.400000</td>\n",
       "      <td>0.208356</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>49</th>\n",
       "      <td>2015-11-08</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.017670</td>\n",
       "      <td>10</td>\n",
       "      <td>4</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.207045</td>\n",
       "      <td>2</td>\n",
       "      <td>2.698064</td>\n",
       "      <td>18.000000</td>\n",
       "      <td>6.600000</td>\n",
       "      <td>13.800000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.245500</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date     team  team_form        xG  shots  shotOnTarget  deep  \\\n",
       "0  2014-08-16  Arsenal          3  1.554110     14             6     9   \n",
       "1  2014-08-23  Arsenal          1  1.433550     13             3     8   \n",
       "2  2014-08-31  Arsenal          1  2.296490     24             6    13   \n",
       "3  2014-09-13  Arsenal          1  2.078040     15             6     9   \n",
       "4  2014-09-20  Arsenal          0  1.362240      9             3     7   \n",
       "5  2014-09-27  Arsenal          1  1.264700     16             6    10   \n",
       "6  2014-10-05  Arsenal          0  0.330699     10             0     6   \n",
       "7  2014-10-18  Arsenal          1  2.148450     25             9    17   \n",
       "8  2014-10-25  Arsenal          0  1.470810     15             5    10   \n",
       "9  2014-11-01  Arsenal          3  4.329800     32            12    19   \n",
       "10 2014-11-09  Arsenal          3  1.776990     12             4    14   \n",
       "11 2014-11-22  Arsenal          0  2.001930     23             9    12   \n",
       "12 2014-11-29  Arsenal          0  1.056030     17             5    12   \n",
       "13 2014-12-03  Arsenal          3  2.373320     19             8    13   \n",
       "14 2014-12-06  Arsenal          3  2.020730     14             6     6   \n",
       "15 2014-12-13  Arsenal          3  2.388190     17             4    11   \n",
       "16 2014-12-21  Arsenal          1  0.754219      7             3     8   \n",
       "17 2014-12-26  Arsenal          3  2.138880     15             5    11   \n",
       "18 2014-12-28  Arsenal          0  3.358860     21             7     7   \n",
       "19 2015-01-01  Arsenal          3  0.849285     11             6     4   \n",
       "20 2015-01-11  Arsenal          3  2.268890     14             6     5   \n",
       "21 2015-01-18  Arsenal          3  1.494760      9             3     4   \n",
       "22 2015-02-01  Arsenal          3  2.358050     13             8     5   \n",
       "23 2015-02-07  Arsenal          3  0.834136      7             3     6   \n",
       "24 2015-02-10  Arsenal          3  1.770950     17             7     5   \n",
       "25 2015-02-21  Arsenal          0  2.080540     12             4     5   \n",
       "26 2015-03-01  Arsenal          3  1.392980     17             4     7   \n",
       "27 2015-03-04  Arsenal          0  2.165100     20             9    15   \n",
       "28 2015-03-14  Arsenal          3  3.196190     19             9    23   \n",
       "29 2015-03-21  Arsenal          0  0.754782      7             3    10   \n",
       "30 2015-04-04  Arsenal          3  1.456720     16            10     5   \n",
       "31 2015-04-11  Arsenal          0  1.210960     17             5     7   \n",
       "32 2015-04-26  Arsenal          1  1.074820     11             1    10   \n",
       "33 2015-05-04  Arsenal          0  2.949380     22             9    18   \n",
       "34 2015-05-11  Arsenal          0  1.883640     23             9    12   \n",
       "35 2015-05-17  Arsenal          1  1.068140      5             3     6   \n",
       "36 2015-05-20  Arsenal          1  1.689090     28             8    25   \n",
       "37 2015-05-24  Arsenal          3  3.166140     24            13    24   \n",
       "38 2015-08-09  Arsenal          0  1.331660     22             6    11   \n",
       "39 2015-08-16  Arsenal          0  2.055420     20             7    15   \n",
       "40 2015-08-24  Arsenal          1  1.837550     19             5    14   \n",
       "41 2015-08-29  Arsenal          0  2.339480     22             9    15   \n",
       "42 2015-09-12  Arsenal          3  4.426840     29            12    20   \n",
       "43 2015-09-19  Arsenal          3  0.775312      9             2     5   \n",
       "44 2015-09-26  Arsenal          3  3.896230     27            12    17   \n",
       "45 2015-10-04  Arsenal          3  2.169520     12             5    12   \n",
       "46 2015-10-17  Arsenal          0  2.690460     17             6    16   \n",
       "47 2015-10-24  Arsenal          3  2.557540     20             5    19   \n",
       "48 2015-10-31  Arsenal          0  2.176570     14             5     5   \n",
       "49 2015-11-08  Arsenal          1  2.017670     10             4     9   \n",
       "\n",
       "    is_home  possession_proxy  final_pos  rolling_xG  rolling_shots  \\\n",
       "0         1          0.672291          3    2.001291      20.793296   \n",
       "1         0          0.155379          3    1.554110      14.000000   \n",
       "2         0          0.221795          3    1.493830      13.500000   \n",
       "3         1          0.142124          3    1.761383      17.000000   \n",
       "4         0          0.603193          3    1.840548      16.500000   \n",
       "5         1          0.195750          3    1.744886      15.000000   \n",
       "6         0          0.057237          3    1.687004      15.400000   \n",
       "7         1          0.638671          3    1.466434      14.800000   \n",
       "8         0          0.230739          3    1.436826      15.000000   \n",
       "9         1          0.259060          3    1.315380      15.000000   \n",
       "10        0          0.232036          3    1.908892      19.600000   \n",
       "11        1          0.183046          3    2.011350      18.800000   \n",
       "12        0          0.231030          3    2.345596      21.400000   \n",
       "13        1          0.241824          3    2.127112      19.800000   \n",
       "14        0          0.133992          3    2.307614      20.600000   \n",
       "15        1          0.215349          3    1.845800      17.000000   \n",
       "16        0          0.109159          3    1.968040      18.000000   \n",
       "17        1          0.191176          3    1.718498      14.800000   \n",
       "18        0          0.225565          3    1.935068      14.400000   \n",
       "19        0          0.078066          3    2.132176      14.800000   \n",
       "20        1          0.255191          3    1.897887      14.200000   \n",
       "21        0          0.218030          3    1.874027      13.600000   \n",
       "22        1          0.230236          3    2.022135      14.000000   \n",
       "23        0          0.118624          3    2.065969      13.600000   \n",
       "24        1          0.206665          3    1.561024      10.800000   \n",
       "25        0          0.143667          3    1.745357      12.000000   \n",
       "26        1          0.237333          3    1.707687      11.600000   \n",
       "27        0          0.261491          3    1.687331      13.200000   \n",
       "28        1          0.260959          3    1.648741      14.600000   \n",
       "29        0          0.128540          3    2.121152      17.000000   \n",
       "30        1          0.163624          3    1.917918      15.000000   \n",
       "31        0          0.194465          3    1.793154      15.800000   \n",
       "32        1          0.167233          3    1.756750      15.800000   \n",
       "33        0          0.658409          3    1.538694      14.000000   \n",
       "34        1          0.653311          3    1.489332      14.600000   \n",
       "35        0          0.179685          3    1.715104      17.800000   \n",
       "36        1          0.158806          3    1.637388      15.600000   \n",
       "37        1          0.254293          3    1.733014      17.800000   \n",
       "38        1          0.613907          2    2.151278      20.400000   \n",
       "39        0          0.204211          2    1.827734      20.400000   \n",
       "40        1          0.176145          2    1.862090      19.800000   \n",
       "41        0          0.695956          2    2.015972      22.600000   \n",
       "42        1          0.287574          2    2.146050      21.400000   \n",
       "43        0          0.081784          2    2.398190      22.400000   \n",
       "44        0          0.221318          2    2.286920      19.800000   \n",
       "45        1          0.202819          2    2.655082      21.200000   \n",
       "46        0          0.274047          2    2.721476      19.800000   \n",
       "47        1          0.261814          2    2.791672      18.800000   \n",
       "48        0          0.267500          2    2.417812      17.000000   \n",
       "49        1          0.207045          2    2.698064      18.000000   \n",
       "\n",
       "    rolling_shotOnTarget  rolling_deep  rolling_team_form  \\\n",
       "0               6.554425      9.948848           2.209085   \n",
       "1               6.000000      9.000000           3.000000   \n",
       "2               4.500000      8.500000           2.000000   \n",
       "3               5.000000     10.000000           1.666667   \n",
       "4               5.250000      9.750000           1.500000   \n",
       "5               4.800000      9.200000           1.200000   \n",
       "6               4.800000      9.400000           0.800000   \n",
       "7               4.200000      9.000000           0.600000   \n",
       "8               4.800000      9.800000           0.600000   \n",
       "9               4.600000     10.000000           0.400000   \n",
       "10              6.400000     12.400000           1.000000   \n",
       "11              6.000000     13.200000           1.400000   \n",
       "12              7.800000     14.400000           1.400000   \n",
       "13              7.000000     13.400000           1.200000   \n",
       "14              7.600000     14.000000           1.800000   \n",
       "15              6.400000     11.400000           1.800000   \n",
       "16              6.400000     10.800000           1.800000   \n",
       "17              5.200000     10.000000           2.000000   \n",
       "18              5.200000      9.800000           2.600000   \n",
       "19              5.000000      8.600000           2.000000   \n",
       "20              5.000000      8.200000           2.000000   \n",
       "21              5.400000      7.000000           2.000000   \n",
       "22              5.400000      6.200000           2.400000   \n",
       "23              6.000000      5.000000           2.400000   \n",
       "24              5.200000      4.800000           3.000000   \n",
       "25              5.400000      5.000000           3.000000   \n",
       "26              5.000000      5.000000           2.400000   \n",
       "27              5.200000      5.600000           2.400000   \n",
       "28              5.400000      7.600000           1.800000   \n",
       "29              6.600000     11.000000           1.800000   \n",
       "30              5.800000     12.000000           1.200000   \n",
       "31              7.000000     12.000000           1.800000   \n",
       "32              7.200000     12.000000           1.200000   \n",
       "33              5.600000     11.000000           1.400000   \n",
       "34              5.600000     10.000000           0.800000   \n",
       "35              6.800000     10.400000           0.800000   \n",
       "36              5.400000     10.600000           0.400000   \n",
       "37              6.000000     14.200000           0.600000   \n",
       "38              8.400000     17.000000           1.000000   \n",
       "39              7.800000     15.600000           1.000000   \n",
       "40              7.400000     16.200000           1.000000   \n",
       "41              7.800000     17.800000           1.000000   \n",
       "42              8.000000     15.800000           0.800000   \n",
       "43              7.800000     15.000000           0.800000   \n",
       "44              7.000000     13.800000           1.400000   \n",
       "45              8.000000     14.200000           2.000000   \n",
       "46              8.000000     13.800000           2.400000   \n",
       "47              7.400000     14.000000           2.400000   \n",
       "48              6.000000     13.800000           2.400000   \n",
       "49              6.600000     13.800000           1.800000   \n",
       "\n",
       "    rolling_possession_proxy  \n",
       "0                   0.261765  \n",
       "1                   0.672291  \n",
       "2                   0.413835  \n",
       "3                   0.349822  \n",
       "4                   0.297897  \n",
       "5                   0.358956  \n",
       "6                   0.263648  \n",
       "7                   0.244020  \n",
       "8                   0.327395  \n",
       "9                   0.345118  \n",
       "10                  0.276291  \n",
       "11                  0.283549  \n",
       "12                  0.308710  \n",
       "13                  0.227182  \n",
       "14                  0.229399  \n",
       "15                  0.204385  \n",
       "16                  0.201048  \n",
       "17                  0.186271  \n",
       "18                  0.178300  \n",
       "19                  0.175048  \n",
       "20                  0.163863  \n",
       "21                  0.171832  \n",
       "22                  0.193606  \n",
       "23                  0.201418  \n",
       "24                  0.180029  \n",
       "25                  0.205749  \n",
       "26                  0.183444  \n",
       "27                  0.187305  \n",
       "28                  0.193556  \n",
       "29                  0.222023  \n",
       "30                  0.206398  \n",
       "31                  0.210389  \n",
       "32                  0.201816  \n",
       "33                  0.182964  \n",
       "34                  0.262454  \n",
       "35                  0.367408  \n",
       "36                  0.370621  \n",
       "37                  0.363489  \n",
       "38                  0.380901  \n",
       "39                  0.372000  \n",
       "40                  0.282180  \n",
       "41                  0.281472  \n",
       "42                  0.388902  \n",
       "43                  0.395559  \n",
       "44                  0.289134  \n",
       "45                  0.292555  \n",
       "46                  0.297890  \n",
       "47                  0.213509  \n",
       "48                  0.208356  \n",
       "49                  0.245500  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "team_df.head(50)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "d477e267",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:10.781533Z",
     "iopub.status.busy": "2025-05-06T13:18:10.780662Z",
     "iopub.status.idle": "2025-05-06T13:18:10.845406Z",
     "shell.execute_reply": "2025-05-06T13:18:10.844468Z"
    },
    "papermill": {
     "duration": 0.078762,
     "end_time": "2025-05-06T13:18:10.848234",
     "exception": false,
     "start_time": "2025-05-06T13:18:10.769472",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>away_team</th>\n",
       "      <th>home_goals</th>\n",
       "      <th>away_goals</th>\n",
       "      <th>is_home</th>\n",
       "      <th>xG_home</th>\n",
       "      <th>xG_away</th>\n",
       "      <th>home_shots</th>\n",
       "      <th>away_shots</th>\n",
       "      <th>home_shotOnTarget</th>\n",
       "      <th>...</th>\n",
       "      <th>rolling_deep</th>\n",
       "      <th>rolling_team_form</th>\n",
       "      <th>rolling_possession_proxy</th>\n",
       "      <th>team_away</th>\n",
       "      <th>rolling_xG_away</th>\n",
       "      <th>rolling_shots_away</th>\n",
       "      <th>rolling_shotOnTarget_away</th>\n",
       "      <th>rolling_deep_away</th>\n",
       "      <th>rolling_team_form_away</th>\n",
       "      <th>rolling_possession_proxy_away</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>home_team</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Arsenal</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>0.158151</td>\n",
       "      <td>14</td>\n",
       "      <td>4</td>\n",
       "      <td>6</td>\n",
       "      <td>...</td>\n",
       "      <td>9.948848</td>\n",
       "      <td>2.209085</td>\n",
       "      <td>0.261765</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1.875943</td>\n",
       "      <td>19.490938</td>\n",
       "      <td>6.143898</td>\n",
       "      <td>9.325717</td>\n",
       "      <td>2.070722</td>\n",
       "      <td>0.245370</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Aston Villa</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Newcastle United</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.507525</td>\n",
       "      <td>0.699295</td>\n",
       "      <td>10</td>\n",
       "      <td>11</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.204729</td>\n",
       "      <td>Newcastle United</td>\n",
       "      <td>0.965583</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.118423</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Bournemouth</th>\n",
       "      <td>2015-08-08</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0.876106</td>\n",
       "      <td>0.782253</td>\n",
       "      <td>11</td>\n",
       "      <td>7</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>9.870731</td>\n",
       "      <td>2.146411</td>\n",
       "      <td>0.247109</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>1.113939</td>\n",
       "      <td>12.600000</td>\n",
       "      <td>4.400000</td>\n",
       "      <td>4.400000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.155859</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Brentford</th>\n",
       "      <td>2021-08-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1.888180</td>\n",
       "      <td>1.023850</td>\n",
       "      <td>8</td>\n",
       "      <td>22</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>10.912578</td>\n",
       "      <td>2.208880</td>\n",
       "      <td>0.256972</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1.223475</td>\n",
       "      <td>12.200000</td>\n",
       "      <td>4.400000</td>\n",
       "      <td>7.200000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.261732</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Brighton</th>\n",
       "      <td>2017-08-12</td>\n",
       "      <td>Manchester City</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.276343</td>\n",
       "      <td>1.867510</td>\n",
       "      <td>6</td>\n",
       "      <td>14</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>10.002475</td>\n",
       "      <td>2.155397</td>\n",
       "      <td>0.254538</td>\n",
       "      <td>Manchester City</td>\n",
       "      <td>2.727974</td>\n",
       "      <td>20.200000</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>14.600000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.311646</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Burnley</th>\n",
       "      <td>2014-08-18</td>\n",
       "      <td>Chelsea</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>0.371141</td>\n",
       "      <td>2.129960</td>\n",
       "      <td>9</td>\n",
       "      <td>11</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>9.196618</td>\n",
       "      <td>2.042056</td>\n",
       "      <td>0.241973</td>\n",
       "      <td>Chelsea</td>\n",
       "      <td>2.058318</td>\n",
       "      <td>21.385805</td>\n",
       "      <td>6.741194</td>\n",
       "      <td>10.232343</td>\n",
       "      <td>2.272033</td>\n",
       "      <td>0.269224</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Cardiff</th>\n",
       "      <td>2018-08-18</td>\n",
       "      <td>Newcastle United</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1.155210</td>\n",
       "      <td>1.554050</td>\n",
       "      <td>12</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>...</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.110071</td>\n",
       "      <td>Newcastle United</td>\n",
       "      <td>1.248807</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>2.800000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.142250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Chelsea</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Leicester</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>2.029390</td>\n",
       "      <td>0.550894</td>\n",
       "      <td>27</td>\n",
       "      <td>6</td>\n",
       "      <td>10</td>\n",
       "      <td>...</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.255483</td>\n",
       "      <td>Leicester</td>\n",
       "      <td>1.278300</td>\n",
       "      <td>11.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.202736</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Crystal Palace</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>0.617283</td>\n",
       "      <td>1.339570</td>\n",
       "      <td>9</td>\n",
       "      <td>17</td>\n",
       "      <td>4</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.027709</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>1.853100</td>\n",
       "      <td>18.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.193693</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Everton</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1.334290</td>\n",
       "      <td>1.433550</td>\n",
       "      <td>8</td>\n",
       "      <td>13</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.097264</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.672291</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Fulham</th>\n",
       "      <td>2018-08-11</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.638076</td>\n",
       "      <td>1.078160</td>\n",
       "      <td>15</td>\n",
       "      <td>12</td>\n",
       "      <td>6</td>\n",
       "      <td>...</td>\n",
       "      <td>10.579496</td>\n",
       "      <td>2.174256</td>\n",
       "      <td>0.251131</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1.829759</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>8.600000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.269195</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Huddersfield</th>\n",
       "      <td>2017-08-20</td>\n",
       "      <td>Newcastle United</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.267008</td>\n",
       "      <td>0.973322</td>\n",
       "      <td>7</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.191147</td>\n",
       "      <td>Newcastle United</td>\n",
       "      <td>0.989215</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>4.400000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.231243</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Hull</th>\n",
       "      <td>2014-08-24</td>\n",
       "      <td>Stoke</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0.870175</td>\n",
       "      <td>1.609160</td>\n",
       "      <td>9</td>\n",
       "      <td>19</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.111082</td>\n",
       "      <td>Stoke</td>\n",
       "      <td>0.423368</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.095271</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Ipswich</th>\n",
       "      <td>2024-08-17</td>\n",
       "      <td>Liverpool</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.342601</td>\n",
       "      <td>3.929060</td>\n",
       "      <td>7</td>\n",
       "      <td>19</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>12.357962</td>\n",
       "      <td>2.117934</td>\n",
       "      <td>0.237818</td>\n",
       "      <td>Liverpool</td>\n",
       "      <td>2.997160</td>\n",
       "      <td>25.200000</td>\n",
       "      <td>9.800000</td>\n",
       "      <td>19.000000</td>\n",
       "      <td>2.200000</td>\n",
       "      <td>0.196378</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Leeds</th>\n",
       "      <td>2020-09-19</td>\n",
       "      <td>Fulham</td>\n",
       "      <td>4</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>1.452540</td>\n",
       "      <td>1.555030</td>\n",
       "      <td>10</td>\n",
       "      <td>14</td>\n",
       "      <td>7</td>\n",
       "      <td>...</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.023641</td>\n",
       "      <td>Fulham</td>\n",
       "      <td>0.868922</td>\n",
       "      <td>10.400000</td>\n",
       "      <td>2.600000</td>\n",
       "      <td>5.200000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.076495</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Leicester</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Everton</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1.278300</td>\n",
       "      <td>0.613273</td>\n",
       "      <td>11</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>9.489707</td>\n",
       "      <td>2.107135</td>\n",
       "      <td>0.249685</td>\n",
       "      <td>Everton</td>\n",
       "      <td>2.021850</td>\n",
       "      <td>21.006905</td>\n",
       "      <td>6.621758</td>\n",
       "      <td>10.051053</td>\n",
       "      <td>2.231779</td>\n",
       "      <td>0.264454</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Liverpool</th>\n",
       "      <td>2014-08-17</td>\n",
       "      <td>Southampton</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.331920</td>\n",
       "      <td>1.552480</td>\n",
       "      <td>12</td>\n",
       "      <td>12</td>\n",
       "      <td>5</td>\n",
       "      <td>...</td>\n",
       "      <td>10.398596</td>\n",
       "      <td>2.308949</td>\n",
       "      <td>0.273598</td>\n",
       "      <td>Southampton</td>\n",
       "      <td>2.014378</td>\n",
       "      <td>20.929270</td>\n",
       "      <td>6.597286</td>\n",
       "      <td>10.013907</td>\n",
       "      <td>2.223531</td>\n",
       "      <td>0.263477</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Luton</th>\n",
       "      <td>2023-09-01</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>2.022440</td>\n",
       "      <td>1.225280</td>\n",
       "      <td>16</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>...</td>\n",
       "      <td>4.500000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.063244</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>1.919760</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>8.200000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.168614</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Manchester City</th>\n",
       "      <td>2014-08-25</td>\n",
       "      <td>Liverpool</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.313750</td>\n",
       "      <td>0.901889</td>\n",
       "      <td>9</td>\n",
       "      <td>11</td>\n",
       "      <td>4</td>\n",
       "      <td>...</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.181577</td>\n",
       "      <td>Liverpool</td>\n",
       "      <td>1.331920</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.138530</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Manchester United</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Swansea</td>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1.166350</td>\n",
       "      <td>0.278076</td>\n",
       "      <td>14</td>\n",
       "      <td>5</td>\n",
       "      <td>5</td>\n",
       "      <td>...</td>\n",
       "      <td>9.087901</td>\n",
       "      <td>2.017916</td>\n",
       "      <td>0.239113</td>\n",
       "      <td>Swansea</td>\n",
       "      <td>2.006455</td>\n",
       "      <td>20.846952</td>\n",
       "      <td>6.571338</td>\n",
       "      <td>9.974521</td>\n",
       "      <td>2.214785</td>\n",
       "      <td>0.262441</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Middlesbrough</th>\n",
       "      <td>2016-08-13</td>\n",
       "      <td>Stoke</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.805230</td>\n",
       "      <td>0.485626</td>\n",
       "      <td>12</td>\n",
       "      <td>12</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>10.323983</td>\n",
       "      <td>2.140158</td>\n",
       "      <td>0.249903</td>\n",
       "      <td>Stoke</td>\n",
       "      <td>0.760277</td>\n",
       "      <td>11.200000</td>\n",
       "      <td>2.800000</td>\n",
       "      <td>4.600000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.082297</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Newcastle United</th>\n",
       "      <td>2014-08-17</td>\n",
       "      <td>Manchester City</td>\n",
       "      <td>0</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.965583</td>\n",
       "      <td>1.480530</td>\n",
       "      <td>12</td>\n",
       "      <td>13</td>\n",
       "      <td>0</td>\n",
       "      <td>...</td>\n",
       "      <td>9.123775</td>\n",
       "      <td>2.025882</td>\n",
       "      <td>0.240057</td>\n",
       "      <td>Manchester City</td>\n",
       "      <td>1.820917</td>\n",
       "      <td>18.919218</td>\n",
       "      <td>5.963681</td>\n",
       "      <td>9.052169</td>\n",
       "      <td>2.009982</td>\n",
       "      <td>0.238173</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Norwich</th>\n",
       "      <td>2015-08-08</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>1.130760</td>\n",
       "      <td>2.109750</td>\n",
       "      <td>17</td>\n",
       "      <td>11</td>\n",
       "      <td>6</td>\n",
       "      <td>...</td>\n",
       "      <td>9.971153</td>\n",
       "      <td>2.168248</td>\n",
       "      <td>0.249623</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1.088769</td>\n",
       "      <td>11.200000</td>\n",
       "      <td>4.200000</td>\n",
       "      <td>6.200000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.140567</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Nottingham Forest</th>\n",
       "      <td>2022-08-14</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1.971700</td>\n",
       "      <td>2.086340</td>\n",
       "      <td>13</td>\n",
       "      <td>19</td>\n",
       "      <td>6</td>\n",
       "      <td>...</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.033771</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>1.046950</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>2.600000</td>\n",
       "      <td>4.400000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.100248</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Queens Park Rangers</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Hull</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.900670</td>\n",
       "      <td>1.117570</td>\n",
       "      <td>19</td>\n",
       "      <td>11</td>\n",
       "      <td>6</td>\n",
       "      <td>...</td>\n",
       "      <td>9.159790</td>\n",
       "      <td>2.033879</td>\n",
       "      <td>0.241004</td>\n",
       "      <td>Hull</td>\n",
       "      <td>1.856966</td>\n",
       "      <td>19.293764</td>\n",
       "      <td>6.081745</td>\n",
       "      <td>9.231376</td>\n",
       "      <td>2.049774</td>\n",
       "      <td>0.242888</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Sheffield United</th>\n",
       "      <td>2019-08-18</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1.847780</td>\n",
       "      <td>0.241912</td>\n",
       "      <td>15</td>\n",
       "      <td>6</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.163147</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1.672799</td>\n",
       "      <td>13.600000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>9.400000</td>\n",
       "      <td>1.600000</td>\n",
       "      <td>0.142367</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Southampton</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>West Bromwich Albion</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.665853</td>\n",
       "      <td>0.665791</td>\n",
       "      <td>9</td>\n",
       "      <td>8</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.161470</td>\n",
       "      <td>West Bromwich Albion</td>\n",
       "      <td>1.683430</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.188773</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Stoke</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0.423368</td>\n",
       "      <td>0.909774</td>\n",
       "      <td>12</td>\n",
       "      <td>7</td>\n",
       "      <td>2</td>\n",
       "      <td>...</td>\n",
       "      <td>9.984534</td>\n",
       "      <td>2.217009</td>\n",
       "      <td>0.262704</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>1.845678</td>\n",
       "      <td>19.176484</td>\n",
       "      <td>6.044776</td>\n",
       "      <td>9.175262</td>\n",
       "      <td>2.037314</td>\n",
       "      <td>0.241411</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Sunderland</th>\n",
       "      <td>2014-08-24</td>\n",
       "      <td>Manchester United</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0.666489</td>\n",
       "      <td>0.941557</td>\n",
       "      <td>11</td>\n",
       "      <td>10</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.111227</td>\n",
       "      <td>Manchester United</td>\n",
       "      <td>1.166350</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.242245</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Swansea</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Burnley</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.914215</td>\n",
       "      <td>0.843331</td>\n",
       "      <td>10</td>\n",
       "      <td>12</td>\n",
       "      <td>5</td>\n",
       "      <td>...</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.057755</td>\n",
       "      <td>Burnley</td>\n",
       "      <td>0.371141</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.044517</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Tottenham</th>\n",
       "      <td>2014-08-24</td>\n",
       "      <td>Queens Park Rangers</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>2.388940</td>\n",
       "      <td>1.076170</td>\n",
       "      <td>18</td>\n",
       "      <td>9</td>\n",
       "      <td>5</td>\n",
       "      <td>...</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.106307</td>\n",
       "      <td>Queens Park Rangers</td>\n",
       "      <td>1.900670</td>\n",
       "      <td>19.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.188918</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Watford</th>\n",
       "      <td>2015-08-15</td>\n",
       "      <td>West Bromwich Albion</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.760848</td>\n",
       "      <td>0.684036</td>\n",
       "      <td>16</td>\n",
       "      <td>6</td>\n",
       "      <td>5</td>\n",
       "      <td>...</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.144019</td>\n",
       "      <td>West Bromwich Albion</td>\n",
       "      <td>0.752021</td>\n",
       "      <td>9.200000</td>\n",
       "      <td>3.600000</td>\n",
       "      <td>3.400000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.089702</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>West Bromwich Albion</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Sunderland</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>1.683430</td>\n",
       "      <td>0.991901</td>\n",
       "      <td>10</td>\n",
       "      <td>7</td>\n",
       "      <td>5</td>\n",
       "      <td>...</td>\n",
       "      <td>9.394441</td>\n",
       "      <td>2.085982</td>\n",
       "      <td>0.247178</td>\n",
       "      <td>Sunderland</td>\n",
       "      <td>1.979198</td>\n",
       "      <td>20.563753</td>\n",
       "      <td>6.482069</td>\n",
       "      <td>9.839020</td>\n",
       "      <td>2.184698</td>\n",
       "      <td>0.258875</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>West Ham</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1.853100</td>\n",
       "      <td>1.017060</td>\n",
       "      <td>18</td>\n",
       "      <td>10</td>\n",
       "      <td>4</td>\n",
       "      <td>...</td>\n",
       "      <td>10.066718</td>\n",
       "      <td>2.235257</td>\n",
       "      <td>0.264866</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>2.106762</td>\n",
       "      <td>21.889135</td>\n",
       "      <td>6.899853</td>\n",
       "      <td>10.473168</td>\n",
       "      <td>2.325507</td>\n",
       "      <td>0.275561</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Wolverhampton Wanderers</th>\n",
       "      <td>2018-08-11</td>\n",
       "      <td>Everton</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.891038</td>\n",
       "      <td>0.715382</td>\n",
       "      <td>11</td>\n",
       "      <td>6</td>\n",
       "      <td>4</td>\n",
       "      <td>...</td>\n",
       "      <td>10.052228</td>\n",
       "      <td>2.065894</td>\n",
       "      <td>0.238615</td>\n",
       "      <td>Everton</td>\n",
       "      <td>1.121282</td>\n",
       "      <td>10.200000</td>\n",
       "      <td>3.800000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>1.600000</td>\n",
       "      <td>0.170897</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>35 rows × 30 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                              date             away_team  home_goals  \\\n",
       "home_team                                                              \n",
       "Arsenal                 2014-08-16        Crystal Palace           2   \n",
       "Aston Villa             2014-08-23      Newcastle United           0   \n",
       "Bournemouth             2015-08-08           Aston Villa           0   \n",
       "Brentford               2021-08-13               Arsenal           2   \n",
       "Brighton                2017-08-12       Manchester City           0   \n",
       "Burnley                 2014-08-18               Chelsea           1   \n",
       "Cardiff                 2018-08-18      Newcastle United           0   \n",
       "Chelsea                 2014-08-23             Leicester           2   \n",
       "Crystal Palace          2014-08-23              West Ham           1   \n",
       "Everton                 2014-08-23               Arsenal           2   \n",
       "Fulham                  2018-08-11        Crystal Palace           0   \n",
       "Huddersfield            2017-08-20      Newcastle United           1   \n",
       "Hull                    2014-08-24                 Stoke           1   \n",
       "Ipswich                 2024-08-17             Liverpool           0   \n",
       "Leeds                   2020-09-19                Fulham           4   \n",
       "Leicester               2014-08-16               Everton           2   \n",
       "Liverpool               2014-08-17           Southampton           2   \n",
       "Luton                   2023-09-01              West Ham           1   \n",
       "Manchester City         2014-08-25             Liverpool           3   \n",
       "Manchester United       2014-08-16               Swansea           1   \n",
       "Middlesbrough           2016-08-13                 Stoke           1   \n",
       "Newcastle United        2014-08-17       Manchester City           0   \n",
       "Norwich                 2015-08-08        Crystal Palace           1   \n",
       "Nottingham Forest       2022-08-14              West Ham           1   \n",
       "Queens Park Rangers     2014-08-16                  Hull           0   \n",
       "Sheffield United        2019-08-18        Crystal Palace           1   \n",
       "Southampton             2014-08-23  West Bromwich Albion           0   \n",
       "Stoke                   2014-08-16           Aston Villa           0   \n",
       "Sunderland              2014-08-24     Manchester United           1   \n",
       "Swansea                 2014-08-23               Burnley           1   \n",
       "Tottenham               2014-08-24   Queens Park Rangers           4   \n",
       "Watford                 2015-08-15  West Bromwich Albion           0   \n",
       "West Bromwich Albion    2014-08-16            Sunderland           2   \n",
       "West Ham                2014-08-16             Tottenham           0   \n",
       "Wolverhampton Wanderers 2018-08-11               Everton           2   \n",
       "\n",
       "                         away_goals  is_home   xG_home   xG_away  home_shots  \\\n",
       "home_team                                                                      \n",
       "Arsenal                           1        1  1.554110  0.158151          14   \n",
       "Aston Villa                       0        1  0.507525  0.699295          10   \n",
       "Bournemouth                       1        1  0.876106  0.782253          11   \n",
       "Brentford                         0        1  1.888180  1.023850           8   \n",
       "Brighton                          2        1  0.276343  1.867510           6   \n",
       "Burnley                           3        1  0.371141  2.129960           9   \n",
       "Cardiff                           0        1  1.155210  1.554050          12   \n",
       "Chelsea                           0        1  2.029390  0.550894          27   \n",
       "Crystal Palace                    3        1  0.617283  1.339570           9   \n",
       "Everton                           2        1  1.334290  1.433550           8   \n",
       "Fulham                            2        1  0.638076  1.078160          15   \n",
       "Huddersfield                      0        1  0.267008  0.973322           7   \n",
       "Hull                              1        1  0.870175  1.609160           9   \n",
       "Ipswich                           2        1  0.342601  3.929060           7   \n",
       "Leeds                             3        1  1.452540  1.555030          10   \n",
       "Leicester                         2        1  1.278300  0.613273          11   \n",
       "Liverpool                         1        1  1.331920  1.552480          12   \n",
       "Luton                             2        1  2.022440  1.225280          16   \n",
       "Manchester City                   1        1  1.313750  0.901889           9   \n",
       "Manchester United                 2        1  1.166350  0.278076          14   \n",
       "Middlesbrough                     1        1  1.805230  0.485626          12   \n",
       "Newcastle United                  2        1  0.965583  1.480530          12   \n",
       "Norwich                           3        1  1.130760  2.109750          17   \n",
       "Nottingham Forest                 0        1  1.971700  2.086340          13   \n",
       "Queens Park Rangers               1        1  1.900670  1.117570          19   \n",
       "Sheffield United                  0        1  1.847780  0.241912          15   \n",
       "Southampton                       0        1  0.665853  0.665791           9   \n",
       "Stoke                             1        1  0.423368  0.909774          12   \n",
       "Sunderland                        1        1  0.666489  0.941557          11   \n",
       "Swansea                           0        1  0.914215  0.843331          10   \n",
       "Tottenham                         0        1  2.388940  1.076170          18   \n",
       "Watford                           0        1  0.760848  0.684036          16   \n",
       "West Bromwich Albion              2        1  1.683430  0.991901          10   \n",
       "West Ham                          1        1  1.853100  1.017060          18   \n",
       "Wolverhampton Wanderers           2        1  0.891038  0.715382          11   \n",
       "\n",
       "                         away_shots  home_shotOnTarget  ...  rolling_deep  \\\n",
       "home_team                                               ...                 \n",
       "Arsenal                           4                  6  ...      9.948848   \n",
       "Aston Villa                      11                  0  ...      4.000000   \n",
       "Bournemouth                       7                  2  ...      9.870731   \n",
       "Brentford                        22                  3  ...     10.912578   \n",
       "Brighton                         14                  2  ...     10.002475   \n",
       "Burnley                          11                  2  ...      9.196618   \n",
       "Cardiff                          12                  1  ...      5.000000   \n",
       "Chelsea                           6                 10  ...     10.000000   \n",
       "Crystal Palace                   17                  4  ...      0.000000   \n",
       "Everton                          13                  2  ...     15.000000   \n",
       "Fulham                           12                  6  ...     10.579496   \n",
       "Huddersfield                     13                  3  ...      5.000000   \n",
       "Hull                             19                  2  ...      5.000000   \n",
       "Ipswich                          19                  2  ...     12.357962   \n",
       "Leeds                            14                  7  ...      2.000000   \n",
       "Leicester                        13                  3  ...      9.489707   \n",
       "Liverpool                        12                  5  ...     10.398596   \n",
       "Luton                             9                  1  ...      4.500000   \n",
       "Manchester City                  11                  4  ...      9.000000   \n",
       "Manchester United                 5                  5  ...      9.087901   \n",
       "Middlesbrough                    12                  2  ...     10.323983   \n",
       "Newcastle United                 13                  0  ...      9.123775   \n",
       "Norwich                          11                  6  ...      9.971153   \n",
       "Nottingham Forest                19                  6  ...      2.000000   \n",
       "Queens Park Rangers              11                  6  ...      9.159790   \n",
       "Sheffield United                  6                  3  ...      6.000000   \n",
       "Southampton                       8                  2  ...      9.000000   \n",
       "Stoke                             7                  2  ...      9.984534   \n",
       "Sunderland                       10                  3  ...      3.000000   \n",
       "Swansea                          12                  5  ...      2.000000   \n",
       "Tottenham                         9                  5  ...      3.000000   \n",
       "Watford                           6                  5  ...      4.000000   \n",
       "West Bromwich Albion              7                  5  ...      9.394441   \n",
       "West Ham                         10                  4  ...     10.066718   \n",
       "Wolverhampton Wanderers           6                  4  ...     10.052228   \n",
       "\n",
       "                         rolling_team_form  rolling_possession_proxy  \\\n",
       "home_team                                                              \n",
       "Arsenal                           2.209085                  0.261765   \n",
       "Aston Villa                       3.000000                  0.204729   \n",
       "Bournemouth                       2.146411                  0.247109   \n",
       "Brentford                         2.208880                  0.256972   \n",
       "Brighton                          2.155397                  0.254538   \n",
       "Burnley                           2.042056                  0.241973   \n",
       "Cardiff                           0.000000                  0.110071   \n",
       "Chelsea                           0.000000                  0.255483   \n",
       "Crystal Palace                    0.000000                  0.027709   \n",
       "Everton                           1.000000                  0.097264   \n",
       "Fulham                            2.174256                  0.251131   \n",
       "Huddersfield                      3.000000                  0.191147   \n",
       "Hull                              0.000000                  0.111082   \n",
       "Ipswich                           2.117934                  0.237818   \n",
       "Leeds                             0.000000                  0.023641   \n",
       "Leicester                         2.107135                  0.249685   \n",
       "Liverpool                         2.308949                  0.273598   \n",
       "Luton                             0.000000                  0.063244   \n",
       "Manchester City                   0.000000                  0.181577   \n",
       "Manchester United                 2.017916                  0.239113   \n",
       "Middlesbrough                     2.140158                  0.249903   \n",
       "Newcastle United                  2.025882                  0.240057   \n",
       "Norwich                           2.168248                  0.249623   \n",
       "Nottingham Forest                 0.000000                  0.033771   \n",
       "Queens Park Rangers               2.033879                  0.241004   \n",
       "Sheffield United                  1.000000                  0.163147   \n",
       "Southampton                       0.000000                  0.161470   \n",
       "Stoke                             2.217009                  0.262704   \n",
       "Sunderland                        1.000000                  0.111227   \n",
       "Swansea                           3.000000                  0.057755   \n",
       "Tottenham                         0.000000                  0.106307   \n",
       "Watford                           1.000000                  0.144019   \n",
       "West Bromwich Albion              2.085982                  0.247178   \n",
       "West Ham                          2.235257                  0.264866   \n",
       "Wolverhampton Wanderers           2.065894                  0.238615   \n",
       "\n",
       "                                    team_away  rolling_xG_away  \\\n",
       "home_team                                                        \n",
       "Arsenal                        Crystal Palace         1.875943   \n",
       "Aston Villa                  Newcastle United         0.965583   \n",
       "Bournemouth                       Aston Villa         1.113939   \n",
       "Brentford                             Arsenal         1.223475   \n",
       "Brighton                      Manchester City         2.727974   \n",
       "Burnley                               Chelsea         2.058318   \n",
       "Cardiff                      Newcastle United         1.248807   \n",
       "Chelsea                             Leicester         1.278300   \n",
       "Crystal Palace                       West Ham         1.853100   \n",
       "Everton                               Arsenal         1.554110   \n",
       "Fulham                         Crystal Palace         1.829759   \n",
       "Huddersfield                 Newcastle United         0.989215   \n",
       "Hull                                    Stoke         0.423368   \n",
       "Ipswich                             Liverpool         2.997160   \n",
       "Leeds                                  Fulham         0.868922   \n",
       "Leicester                             Everton         2.021850   \n",
       "Liverpool                         Southampton         2.014378   \n",
       "Luton                                West Ham         1.919760   \n",
       "Manchester City                     Liverpool         1.331920   \n",
       "Manchester United                     Swansea         2.006455   \n",
       "Middlesbrough                           Stoke         0.760277   \n",
       "Newcastle United              Manchester City         1.820917   \n",
       "Norwich                        Crystal Palace         1.088769   \n",
       "Nottingham Forest                    West Ham         1.046950   \n",
       "Queens Park Rangers                      Hull         1.856966   \n",
       "Sheffield United               Crystal Palace         1.672799   \n",
       "Southampton              West Bromwich Albion         1.683430   \n",
       "Stoke                             Aston Villa         1.845678   \n",
       "Sunderland                  Manchester United         1.166350   \n",
       "Swansea                               Burnley         0.371141   \n",
       "Tottenham                 Queens Park Rangers         1.900670   \n",
       "Watford                  West Bromwich Albion         0.752021   \n",
       "West Bromwich Albion               Sunderland         1.979198   \n",
       "West Ham                            Tottenham         2.106762   \n",
       "Wolverhampton Wanderers               Everton         1.121282   \n",
       "\n",
       "                         rolling_shots_away rolling_shotOnTarget_away  \\\n",
       "home_team                                                               \n",
       "Arsenal                           19.490938                  6.143898   \n",
       "Aston Villa                       12.000000                  0.000000   \n",
       "Bournemouth                       12.600000                  4.400000   \n",
       "Brentford                         12.200000                  4.400000   \n",
       "Brighton                          20.200000                  8.000000   \n",
       "Burnley                           21.385805                  6.741194   \n",
       "Cardiff                           14.000000                  2.800000   \n",
       "Chelsea                           11.000000                  3.000000   \n",
       "Crystal Palace                    18.000000                  4.000000   \n",
       "Everton                           14.000000                  6.000000   \n",
       "Fulham                            12.000000                  5.000000   \n",
       "Huddersfield                      10.000000                  4.400000   \n",
       "Hull                              12.000000                  2.000000   \n",
       "Ipswich                           25.200000                  9.800000   \n",
       "Leeds                             10.400000                  2.600000   \n",
       "Leicester                         21.006905                  6.621758   \n",
       "Liverpool                         20.929270                  6.597286   \n",
       "Luton                             15.000000                  5.400000   \n",
       "Manchester City                   12.000000                  5.000000   \n",
       "Manchester United                 20.846952                  6.571338   \n",
       "Middlesbrough                     11.200000                  2.800000   \n",
       "Newcastle United                  18.919218                  5.963681   \n",
       "Norwich                           11.200000                  4.200000   \n",
       "Nottingham Forest                  8.000000                  2.600000   \n",
       "Queens Park Rangers               19.293764                  6.081745   \n",
       "Sheffield United                  13.600000                  4.800000   \n",
       "Southampton                       10.000000                  5.000000   \n",
       "Stoke                             19.176484                  6.044776   \n",
       "Sunderland                        14.000000                  5.000000   \n",
       "Swansea                            9.000000                  2.000000   \n",
       "Tottenham                         19.000000                  6.000000   \n",
       "Watford                            9.200000                  3.600000   \n",
       "West Bromwich Albion              20.563753                  6.482069   \n",
       "West Ham                          21.889135                  6.899853   \n",
       "Wolverhampton Wanderers           10.200000                  3.800000   \n",
       "\n",
       "                         rolling_deep_away  rolling_team_form_away  \\\n",
       "home_team                                                            \n",
       "Arsenal                           9.325717                2.070722   \n",
       "Aston Villa                       6.000000                3.000000   \n",
       "Bournemouth                       4.400000                0.000000   \n",
       "Brentford                         7.200000                1.800000   \n",
       "Brighton                         14.600000                2.000000   \n",
       "Burnley                          10.232343                2.272033   \n",
       "Cardiff                           7.000000                1.200000   \n",
       "Chelsea                           1.000000                1.000000   \n",
       "Crystal Palace                    9.000000                3.000000   \n",
       "Everton                           9.000000                3.000000   \n",
       "Fulham                            8.600000                1.400000   \n",
       "Huddersfield                      4.000000                1.000000   \n",
       "Hull                              3.000000                0.000000   \n",
       "Ipswich                          19.000000                2.200000   \n",
       "Leeds                             5.200000                1.800000   \n",
       "Leicester                        10.051053                2.231779   \n",
       "Liverpool                        10.013907                2.223531   \n",
       "Luton                             8.200000                1.400000   \n",
       "Manchester City                   6.000000                3.000000   \n",
       "Manchester United                 9.974521                2.214785   \n",
       "Middlesbrough                     4.600000                1.400000   \n",
       "Newcastle United                  9.052169                2.009982   \n",
       "Norwich                           6.200000                1.200000   \n",
       "Nottingham Forest                 4.400000                2.000000   \n",
       "Queens Park Rangers               9.231376                2.049774   \n",
       "Sheffield United                  9.400000                1.600000   \n",
       "Southampton                       6.000000                1.000000   \n",
       "Stoke                             9.175262                2.037314   \n",
       "Sunderland                        8.000000                0.000000   \n",
       "Swansea                           2.000000                3.000000   \n",
       "Tottenham                         1.000000                3.000000   \n",
       "Watford                           3.400000                1.400000   \n",
       "West Bromwich Albion              9.839020                2.184698   \n",
       "West Ham                         10.473168                2.325507   \n",
       "Wolverhampton Wanderers           5.400000                1.600000   \n",
       "\n",
       "                         rolling_possession_proxy_away  \n",
       "home_team                                               \n",
       "Arsenal                                       0.245370  \n",
       "Aston Villa                                   0.118423  \n",
       "Bournemouth                                   0.155859  \n",
       "Brentford                                     0.261732  \n",
       "Brighton                                      0.311646  \n",
       "Burnley                                       0.269224  \n",
       "Cardiff                                       0.142250  \n",
       "Chelsea                                       0.202736  \n",
       "Crystal Palace                                0.193693  \n",
       "Everton                                       0.672291  \n",
       "Fulham                                        0.269195  \n",
       "Huddersfield                                  0.231243  \n",
       "Hull                                          0.095271  \n",
       "Ipswich                                       0.196378  \n",
       "Leeds                                         0.076495  \n",
       "Leicester                                     0.264454  \n",
       "Liverpool                                     0.263477  \n",
       "Luton                                         0.168614  \n",
       "Manchester City                               0.138530  \n",
       "Manchester United                             0.262441  \n",
       "Middlesbrough                                 0.082297  \n",
       "Newcastle United                              0.238173  \n",
       "Norwich                                       0.140567  \n",
       "Nottingham Forest                             0.100248  \n",
       "Queens Park Rangers                           0.242888  \n",
       "Sheffield United                              0.142367  \n",
       "Southampton                                   0.188773  \n",
       "Stoke                                         0.241411  \n",
       "Sunderland                                    0.242245  \n",
       "Swansea                                       0.044517  \n",
       "Tottenham                                     0.188918  \n",
       "Watford                                       0.089702  \n",
       "West Bromwich Albion                          0.258875  \n",
       "West Ham                                      0.275561  \n",
       "Wolverhampton Wanderers                       0.170897  \n",
       "\n",
       "[35 rows x 30 columns]"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "prepared_df = merge(match_df, team_df)\n",
    "prepared_df.groupby('home_team').first()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "24b1fcaa",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:10.873065Z",
     "iopub.status.busy": "2025-05-06T13:18:10.872755Z",
     "iopub.status.idle": "2025-05-06T13:18:10.878577Z",
     "shell.execute_reply": "2025-05-06T13:18:10.877803Z"
    },
    "papermill": {
     "duration": 0.017869,
     "end_time": "2025-05-06T13:18:10.880060",
     "exception": false,
     "start_time": "2025-05-06T13:18:10.862191",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['date', 'home_team', 'away_team', 'home_goals', 'away_goals', 'is_home',\n",
       "       'xG_home', 'xG_away', 'home_shots', 'away_shots', 'home_shotOnTarget',\n",
       "       'away_shotOnTarget', 'home_deep', 'away_deep', 'result',\n",
       "       'home_final_pos', 'away_final_pos', 'team', 'rolling_xG',\n",
       "       'rolling_shots', 'rolling_shotOnTarget', 'rolling_deep',\n",
       "       'rolling_team_form', 'rolling_possession_proxy', 'team_away',\n",
       "       'rolling_xG_away', 'rolling_shots_away', 'rolling_shotOnTarget_away',\n",
       "       'rolling_deep_away', 'rolling_team_form_away',\n",
       "       'rolling_possession_proxy_away'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#prepared_df = prepared_df.drop(['team_away', 'is_home'], axis=1)\n",
    "prepared_df.columns\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "4d48e214",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:10.896686Z",
     "iopub.status.busy": "2025-05-06T13:18:10.896346Z",
     "iopub.status.idle": "2025-05-06T13:18:10.911131Z",
     "shell.execute_reply": "2025-05-06T13:18:10.910084Z"
    },
    "papermill": {
     "duration": 0.025326,
     "end_time": "2025-05-06T13:18:10.913260",
     "exception": false,
     "start_time": "2025-05-06T13:18:10.887934",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>home_team</th>\n",
       "      <th>away_team</th>\n",
       "      <th>team</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>2014-09-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Manchester City</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>51</th>\n",
       "      <td>2014-09-27</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Tottenham</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>74</th>\n",
       "      <td>2014-10-18</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Hull</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>95</th>\n",
       "      <td>2014-11-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Burnley</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>110</th>\n",
       "      <td>2014-11-22</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Manchester United</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>138</th>\n",
       "      <td>2014-12-03</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Southampton</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>156</th>\n",
       "      <td>2014-12-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Newcastle United</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>179</th>\n",
       "      <td>2014-12-26</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Queens Park Rangers</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>209</th>\n",
       "      <td>2015-01-11</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Stoke</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>229</th>\n",
       "      <td>2015-02-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>242</th>\n",
       "      <td>2015-02-10</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Leicester</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>267</th>\n",
       "      <td>2015-03-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Everton</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>279</th>\n",
       "      <td>2015-03-14</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>301</th>\n",
       "      <td>2015-04-04</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Liverpool</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>336</th>\n",
       "      <td>2015-04-26</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Chelsea</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>358</th>\n",
       "      <td>2015-05-11</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Swansea</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>369</th>\n",
       "      <td>2015-05-20</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>Sunderland</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>373</th>\n",
       "      <td>2015-05-24</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>West Bromwich Albion</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>387</th>\n",
       "      <td>2015-08-09</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>West Ham</td>\n",
       "      <td>Arsenal</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "          date home_team             away_team     team\n",
       "2   2014-08-16   Arsenal        Crystal Palace  Arsenal\n",
       "33  2014-09-13   Arsenal       Manchester City  Arsenal\n",
       "51  2014-09-27   Arsenal             Tottenham  Arsenal\n",
       "74  2014-10-18   Arsenal                  Hull  Arsenal\n",
       "95  2014-11-01   Arsenal               Burnley  Arsenal\n",
       "110 2014-11-22   Arsenal     Manchester United  Arsenal\n",
       "138 2014-12-03   Arsenal           Southampton  Arsenal\n",
       "156 2014-12-13   Arsenal      Newcastle United  Arsenal\n",
       "179 2014-12-26   Arsenal   Queens Park Rangers  Arsenal\n",
       "209 2015-01-11   Arsenal                 Stoke  Arsenal\n",
       "229 2015-02-01   Arsenal           Aston Villa  Arsenal\n",
       "242 2015-02-10   Arsenal             Leicester  Arsenal\n",
       "267 2015-03-01   Arsenal               Everton  Arsenal\n",
       "279 2015-03-14   Arsenal              West Ham  Arsenal\n",
       "301 2015-04-04   Arsenal             Liverpool  Arsenal\n",
       "336 2015-04-26   Arsenal               Chelsea  Arsenal\n",
       "358 2015-05-11   Arsenal               Swansea  Arsenal\n",
       "369 2015-05-20   Arsenal            Sunderland  Arsenal\n",
       "373 2015-05-24   Arsenal  West Bromwich Albion  Arsenal\n",
       "387 2015-08-09   Arsenal              West Ham  Arsenal"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "prepared_df.sort_values(by=['team', 'date']).head(20).filter(['date', 'home_team', 'away_team', 'team'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "f606fa8e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:10.936663Z",
     "iopub.status.busy": "2025-05-06T13:18:10.936269Z",
     "iopub.status.idle": "2025-05-06T13:18:10.966789Z",
     "shell.execute_reply": "2025-05-06T13:18:10.965807Z"
    },
    "papermill": {
     "duration": 0.041799,
     "end_time": "2025-05-06T13:18:10.968565",
     "exception": false,
     "start_time": "2025-05-06T13:18:10.926766",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>team</th>\n",
       "      <th>team_form</th>\n",
       "      <th>xG</th>\n",
       "      <th>shots</th>\n",
       "      <th>shotOnTarget</th>\n",
       "      <th>deep</th>\n",
       "      <th>is_home</th>\n",
       "      <th>possession_proxy</th>\n",
       "      <th>final_pos</th>\n",
       "      <th>rolling_xG</th>\n",
       "      <th>rolling_shots</th>\n",
       "      <th>rolling_shotOnTarget</th>\n",
       "      <th>rolling_deep</th>\n",
       "      <th>rolling_team_form</th>\n",
       "      <th>rolling_possession_proxy</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.672291</td>\n",
       "      <td>3</td>\n",
       "      <td>2.001291</td>\n",
       "      <td>20.793296</td>\n",
       "      <td>6.554425</td>\n",
       "      <td>9.948848</td>\n",
       "      <td>2.209085</td>\n",
       "      <td>0.261765</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.433550</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0.155379</td>\n",
       "      <td>3</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.672291</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2014-08-31</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.296490</td>\n",
       "      <td>24</td>\n",
       "      <td>6</td>\n",
       "      <td>13</td>\n",
       "      <td>0</td>\n",
       "      <td>0.221795</td>\n",
       "      <td>3</td>\n",
       "      <td>1.493830</td>\n",
       "      <td>13.500000</td>\n",
       "      <td>4.500000</td>\n",
       "      <td>8.500000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.413835</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2014-09-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.078040</td>\n",
       "      <td>15</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.142124</td>\n",
       "      <td>3</td>\n",
       "      <td>1.761383</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>1.666667</td>\n",
       "      <td>0.349822</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2014-09-20</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.362240</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>0.603193</td>\n",
       "      <td>3</td>\n",
       "      <td>1.840548</td>\n",
       "      <td>16.500000</td>\n",
       "      <td>5.250000</td>\n",
       "      <td>9.750000</td>\n",
       "      <td>1.500000</td>\n",
       "      <td>0.297897</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2014-09-27</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.264700</td>\n",
       "      <td>16</td>\n",
       "      <td>6</td>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>0.195750</td>\n",
       "      <td>3</td>\n",
       "      <td>1.744886</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>9.200000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.358956</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>2014-10-05</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>0.330699</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0.057237</td>\n",
       "      <td>3</td>\n",
       "      <td>1.687004</td>\n",
       "      <td>15.400000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>9.400000</td>\n",
       "      <td>0.800000</td>\n",
       "      <td>0.263648</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>2014-10-18</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.148450</td>\n",
       "      <td>25</td>\n",
       "      <td>9</td>\n",
       "      <td>17</td>\n",
       "      <td>1</td>\n",
       "      <td>0.638671</td>\n",
       "      <td>3</td>\n",
       "      <td>1.466434</td>\n",
       "      <td>14.800000</td>\n",
       "      <td>4.200000</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>0.600000</td>\n",
       "      <td>0.244020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>2014-10-25</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.470810</td>\n",
       "      <td>15</td>\n",
       "      <td>5</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>0.230739</td>\n",
       "      <td>3</td>\n",
       "      <td>1.436826</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>9.800000</td>\n",
       "      <td>0.600000</td>\n",
       "      <td>0.327395</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>2014-11-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>4.329800</td>\n",
       "      <td>32</td>\n",
       "      <td>12</td>\n",
       "      <td>19</td>\n",
       "      <td>1</td>\n",
       "      <td>0.259060</td>\n",
       "      <td>3</td>\n",
       "      <td>1.315380</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>4.600000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>0.400000</td>\n",
       "      <td>0.345118</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>2014-11-09</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.776990</td>\n",
       "      <td>12</td>\n",
       "      <td>4</td>\n",
       "      <td>14</td>\n",
       "      <td>0</td>\n",
       "      <td>0.232036</td>\n",
       "      <td>3</td>\n",
       "      <td>1.908892</td>\n",
       "      <td>19.600000</td>\n",
       "      <td>6.400000</td>\n",
       "      <td>12.400000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.276291</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>2014-11-22</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>2.001930</td>\n",
       "      <td>23</td>\n",
       "      <td>9</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>0.183046</td>\n",
       "      <td>3</td>\n",
       "      <td>2.011350</td>\n",
       "      <td>18.800000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>13.200000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.283549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>2014-11-29</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.056030</td>\n",
       "      <td>17</td>\n",
       "      <td>5</td>\n",
       "      <td>12</td>\n",
       "      <td>0</td>\n",
       "      <td>0.231030</td>\n",
       "      <td>3</td>\n",
       "      <td>2.345596</td>\n",
       "      <td>21.400000</td>\n",
       "      <td>7.800000</td>\n",
       "      <td>14.400000</td>\n",
       "      <td>1.400000</td>\n",
       "      <td>0.308710</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>2014-12-03</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.373320</td>\n",
       "      <td>19</td>\n",
       "      <td>8</td>\n",
       "      <td>13</td>\n",
       "      <td>1</td>\n",
       "      <td>0.241824</td>\n",
       "      <td>3</td>\n",
       "      <td>2.127112</td>\n",
       "      <td>19.800000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>13.400000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.227182</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>2014-12-06</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.020730</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>0.133992</td>\n",
       "      <td>3</td>\n",
       "      <td>2.307614</td>\n",
       "      <td>20.600000</td>\n",
       "      <td>7.600000</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.229399</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2014-12-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.388190</td>\n",
       "      <td>17</td>\n",
       "      <td>4</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>0.215349</td>\n",
       "      <td>3</td>\n",
       "      <td>1.845800</td>\n",
       "      <td>17.000000</td>\n",
       "      <td>6.400000</td>\n",
       "      <td>11.400000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.204385</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>2014-12-21</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>0.754219</td>\n",
       "      <td>7</td>\n",
       "      <td>3</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0.109159</td>\n",
       "      <td>3</td>\n",
       "      <td>1.968040</td>\n",
       "      <td>18.000000</td>\n",
       "      <td>6.400000</td>\n",
       "      <td>10.800000</td>\n",
       "      <td>1.800000</td>\n",
       "      <td>0.201048</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>2014-12-26</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>2.138880</td>\n",
       "      <td>15</td>\n",
       "      <td>5</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>0.191176</td>\n",
       "      <td>3</td>\n",
       "      <td>1.718498</td>\n",
       "      <td>14.800000</td>\n",
       "      <td>5.200000</td>\n",
       "      <td>10.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.186271</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>2014-12-28</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>3.358860</td>\n",
       "      <td>21</td>\n",
       "      <td>7</td>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>0.225565</td>\n",
       "      <td>3</td>\n",
       "      <td>1.935068</td>\n",
       "      <td>14.400000</td>\n",
       "      <td>5.200000</td>\n",
       "      <td>9.800000</td>\n",
       "      <td>2.600000</td>\n",
       "      <td>0.178300</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>0.849285</td>\n",
       "      <td>11</td>\n",
       "      <td>6</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.078066</td>\n",
       "      <td>3</td>\n",
       "      <td>2.132176</td>\n",
       "      <td>14.800000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>8.600000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.175048</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "         date     team  team_form        xG  shots  shotOnTarget  deep  \\\n",
       "0  2014-08-16  Arsenal          3  1.554110     14             6     9   \n",
       "1  2014-08-23  Arsenal          1  1.433550     13             3     8   \n",
       "2  2014-08-31  Arsenal          1  2.296490     24             6    13   \n",
       "3  2014-09-13  Arsenal          1  2.078040     15             6     9   \n",
       "4  2014-09-20  Arsenal          0  1.362240      9             3     7   \n",
       "5  2014-09-27  Arsenal          1  1.264700     16             6    10   \n",
       "6  2014-10-05  Arsenal          0  0.330699     10             0     6   \n",
       "7  2014-10-18  Arsenal          1  2.148450     25             9    17   \n",
       "8  2014-10-25  Arsenal          0  1.470810     15             5    10   \n",
       "9  2014-11-01  Arsenal          3  4.329800     32            12    19   \n",
       "10 2014-11-09  Arsenal          3  1.776990     12             4    14   \n",
       "11 2014-11-22  Arsenal          0  2.001930     23             9    12   \n",
       "12 2014-11-29  Arsenal          0  1.056030     17             5    12   \n",
       "13 2014-12-03  Arsenal          3  2.373320     19             8    13   \n",
       "14 2014-12-06  Arsenal          3  2.020730     14             6     6   \n",
       "15 2014-12-13  Arsenal          3  2.388190     17             4    11   \n",
       "16 2014-12-21  Arsenal          1  0.754219      7             3     8   \n",
       "17 2014-12-26  Arsenal          3  2.138880     15             5    11   \n",
       "18 2014-12-28  Arsenal          0  3.358860     21             7     7   \n",
       "19 2015-01-01  Arsenal          3  0.849285     11             6     4   \n",
       "\n",
       "    is_home  possession_proxy  final_pos  rolling_xG  rolling_shots  \\\n",
       "0         1          0.672291          3    2.001291      20.793296   \n",
       "1         0          0.155379          3    1.554110      14.000000   \n",
       "2         0          0.221795          3    1.493830      13.500000   \n",
       "3         1          0.142124          3    1.761383      17.000000   \n",
       "4         0          0.603193          3    1.840548      16.500000   \n",
       "5         1          0.195750          3    1.744886      15.000000   \n",
       "6         0          0.057237          3    1.687004      15.400000   \n",
       "7         1          0.638671          3    1.466434      14.800000   \n",
       "8         0          0.230739          3    1.436826      15.000000   \n",
       "9         1          0.259060          3    1.315380      15.000000   \n",
       "10        0          0.232036          3    1.908892      19.600000   \n",
       "11        1          0.183046          3    2.011350      18.800000   \n",
       "12        0          0.231030          3    2.345596      21.400000   \n",
       "13        1          0.241824          3    2.127112      19.800000   \n",
       "14        0          0.133992          3    2.307614      20.600000   \n",
       "15        1          0.215349          3    1.845800      17.000000   \n",
       "16        0          0.109159          3    1.968040      18.000000   \n",
       "17        1          0.191176          3    1.718498      14.800000   \n",
       "18        0          0.225565          3    1.935068      14.400000   \n",
       "19        0          0.078066          3    2.132176      14.800000   \n",
       "\n",
       "    rolling_shotOnTarget  rolling_deep  rolling_team_form  \\\n",
       "0               6.554425      9.948848           2.209085   \n",
       "1               6.000000      9.000000           3.000000   \n",
       "2               4.500000      8.500000           2.000000   \n",
       "3               5.000000     10.000000           1.666667   \n",
       "4               5.250000      9.750000           1.500000   \n",
       "5               4.800000      9.200000           1.200000   \n",
       "6               4.800000      9.400000           0.800000   \n",
       "7               4.200000      9.000000           0.600000   \n",
       "8               4.800000      9.800000           0.600000   \n",
       "9               4.600000     10.000000           0.400000   \n",
       "10              6.400000     12.400000           1.000000   \n",
       "11              6.000000     13.200000           1.400000   \n",
       "12              7.800000     14.400000           1.400000   \n",
       "13              7.000000     13.400000           1.200000   \n",
       "14              7.600000     14.000000           1.800000   \n",
       "15              6.400000     11.400000           1.800000   \n",
       "16              6.400000     10.800000           1.800000   \n",
       "17              5.200000     10.000000           2.000000   \n",
       "18              5.200000      9.800000           2.600000   \n",
       "19              5.000000      8.600000           2.000000   \n",
       "\n",
       "    rolling_possession_proxy  \n",
       "0                   0.261765  \n",
       "1                   0.672291  \n",
       "2                   0.413835  \n",
       "3                   0.349822  \n",
       "4                   0.297897  \n",
       "5                   0.358956  \n",
       "6                   0.263648  \n",
       "7                   0.244020  \n",
       "8                   0.327395  \n",
       "9                   0.345118  \n",
       "10                  0.276291  \n",
       "11                  0.283549  \n",
       "12                  0.308710  \n",
       "13                  0.227182  \n",
       "14                  0.229399  \n",
       "15                  0.204385  \n",
       "16                  0.201048  \n",
       "17                  0.186271  \n",
       "18                  0.178300  \n",
       "19                  0.175048  "
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "team_df.sort_values(by=['team', 'date']).head(20)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "f0ca7dee",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:10.994930Z",
     "iopub.status.busy": "2025-05-06T13:18:10.994174Z",
     "iopub.status.idle": "2025-05-06T13:18:11.022328Z",
     "shell.execute_reply": "2025-05-06T13:18:11.021339Z"
    },
    "papermill": {
     "duration": 0.040253,
     "end_time": "2025-05-06T13:18:11.023977",
     "exception": false,
     "start_time": "2025-05-06T13:18:10.983724",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['date', 'team', 'form', 'xG', 'shots', 'shotOnTarget', 'deep',\n",
       "       'is_home', 'possession_proxy', 'final_pos', 'rolling_xG',\n",
       "       'rolling_shots', 'rolling_shotOnTarget', 'rolling_deep',\n",
       "       'rolling_team_form', 'rolling_possession_proxy', 'home_team',\n",
       "       'opponent', 'opponent_xG', 'opponent_shots', 'opponent_shotOnTarget',\n",
       "       'opponent_deep', 'opponent_rolling_xG', 'opponent_rolling_shots',\n",
       "       'opponent_rolling_shotOnTarget', 'opponent_rolling_deep',\n",
       "       'opponent_rolling_team_form', 'opponent_rolling_possession_proxy'],\n",
       "      dtype='object')"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "train1_df = team_df.merge(\n",
    "    prepared_df[['date','home_team', 'away_team', 'xG_away', *[f'away_{stat}' for stat in ['shots', 'shotOnTarget', 'deep']], *[f'rolling_{stat}_away' for stat in ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']]]], \n",
    "    left_on= ['date', 'team'],\n",
    "    right_on = ['date', 'home_team'],\n",
    "    how = 'left'\n",
    ")\n",
    "#train_df.head(10).filter(['date', 'team', 'away_team', 'rolling_xG_away'])\n",
    "train1_df.columns\n",
    "rename_dict = {\n",
    "                'team_form': 'form',\n",
    "               'away_team': 'opponent',\n",
    "               'xG_home': 'xG',\n",
    "               'xG_away': 'opponent_xG',\n",
    "               **{f'away_{stat}': f'opponent_{stat}' for stat in ['shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']},\n",
    "               **{f'rolling_{stat}_away': f'opponent_rolling_{stat}' for stat in ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']}}\n",
    "train1_df = train1_df.rename(columns =rename_dict)\n",
    "train1_df.drop(columns = ['home_team'])\n",
    "train1_df.columns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "760d12bd",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:11.051235Z",
     "iopub.status.busy": "2025-05-06T13:18:11.050916Z",
     "iopub.status.idle": "2025-05-06T13:18:11.076861Z",
     "shell.execute_reply": "2025-05-06T13:18:11.075725Z"
    },
    "papermill": {
     "duration": 0.037324,
     "end_time": "2025-05-06T13:18:11.078222",
     "exception": false,
     "start_time": "2025-05-06T13:18:11.040898",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1458: RuntimeWarning: invalid value encountered in greater\n",
      "  has_large_values = (abs_vals > 1e6).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in less\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in greater\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1458: RuntimeWarning: invalid value encountered in greater\n",
      "  has_large_values = (abs_vals > 1e6).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in less\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in greater\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>team</th>\n",
       "      <th>form</th>\n",
       "      <th>xG</th>\n",
       "      <th>shots</th>\n",
       "      <th>shotOnTarget</th>\n",
       "      <th>deep</th>\n",
       "      <th>is_home</th>\n",
       "      <th>possession_proxy</th>\n",
       "      <th>final_pos</th>\n",
       "      <th>...</th>\n",
       "      <th>opponent_xG</th>\n",
       "      <th>opponent_shots</th>\n",
       "      <th>opponent_shotOnTarget</th>\n",
       "      <th>opponent_deep</th>\n",
       "      <th>opponent_rolling_xG</th>\n",
       "      <th>opponent_rolling_shots</th>\n",
       "      <th>opponent_rolling_shotOnTarget</th>\n",
       "      <th>opponent_rolling_deep</th>\n",
       "      <th>opponent_rolling_team_form</th>\n",
       "      <th>opponent_rolling_possession_proxy</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2223</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>0</td>\n",
       "      <td>0.158151</td>\n",
       "      <td>4</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.027709</td>\n",
       "      <td>10</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2224</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>0</td>\n",
       "      <td>0.617283</td>\n",
       "      <td>9</td>\n",
       "      <td>4</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>0.094634</td>\n",
       "      <td>10</td>\n",
       "      <td>...</td>\n",
       "      <td>1.33957</td>\n",
       "      <td>17.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>1.853100</td>\n",
       "      <td>18.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.193693</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2225</th>\n",
       "      <td>2014-08-30</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1</td>\n",
       "      <td>1.660560</td>\n",
       "      <td>12</td>\n",
       "      <td>7</td>\n",
       "      <td>3</td>\n",
       "      <td>0</td>\n",
       "      <td>0.148338</td>\n",
       "      <td>10</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2226</th>\n",
       "      <td>2014-09-13</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>1</td>\n",
       "      <td>0.780534</td>\n",
       "      <td>16</td>\n",
       "      <td>3</td>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>0.115359</td>\n",
       "      <td>10</td>\n",
       "      <td>...</td>\n",
       "      <td>1.24930</td>\n",
       "      <td>11.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>0.576073</td>\n",
       "      <td>10.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>4.333333</td>\n",
       "      <td>1.333333</td>\n",
       "      <td>0.115191</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2227</th>\n",
       "      <td>2014-09-21</td>\n",
       "      <td>Crystal Palace</td>\n",
       "      <td>0</td>\n",
       "      <td>1.628860</td>\n",
       "      <td>10</td>\n",
       "      <td>3</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.116623</td>\n",
       "      <td>10</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 28 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "           date            team  form        xG  shots  shotOnTarget  deep  \\\n",
       "2223 2014-08-16  Crystal Palace     0  0.158151      4             2     0   \n",
       "2224 2014-08-23  Crystal Palace     0  0.617283      9             4     7   \n",
       "2225 2014-08-30  Crystal Palace     1  1.660560     12             7     3   \n",
       "2226 2014-09-13  Crystal Palace     1  0.780534     16             3     5   \n",
       "2227 2014-09-21  Crystal Palace     0  1.628860     10             3     4   \n",
       "\n",
       "      is_home  possession_proxy  final_pos  ...  opponent_xG  opponent_shots  \\\n",
       "2223        0          0.027709         10  ...          NaN             NaN   \n",
       "2224        1          0.094634         10  ...      1.33957            17.0   \n",
       "2225        0          0.148338         10  ...          NaN             NaN   \n",
       "2226        1          0.115359         10  ...      1.24930            11.0   \n",
       "2227        0          0.116623         10  ...          NaN             NaN   \n",
       "\n",
       "      opponent_shotOnTarget  opponent_deep  opponent_rolling_xG  \\\n",
       "2223                    NaN            NaN                  NaN   \n",
       "2224                    8.0            6.0             1.853100   \n",
       "2225                    NaN            NaN                  NaN   \n",
       "2226                    3.0            4.0             0.576073   \n",
       "2227                    NaN            NaN                  NaN   \n",
       "\n",
       "      opponent_rolling_shots opponent_rolling_shotOnTarget  \\\n",
       "2223                     NaN                           NaN   \n",
       "2224                    18.0                           4.0   \n",
       "2225                     NaN                           NaN   \n",
       "2226                    10.0                           2.0   \n",
       "2227                     NaN                           NaN   \n",
       "\n",
       "     opponent_rolling_deep  opponent_rolling_team_form  \\\n",
       "2223                   NaN                         NaN   \n",
       "2224              9.000000                    3.000000   \n",
       "2225                   NaN                         NaN   \n",
       "2226              4.333333                    1.333333   \n",
       "2227                   NaN                         NaN   \n",
       "\n",
       "      opponent_rolling_possession_proxy  \n",
       "2223                                NaN  \n",
       "2224                           0.193693  \n",
       "2225                                NaN  \n",
       "2226                           0.115191  \n",
       "2227                                NaN  \n",
       "\n",
       "[5 rows x 28 columns]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "train1_df[train1_df['team']== 'Crystal Palace'].head(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "15f59cbd",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:11.099220Z",
     "iopub.status.busy": "2025-05-06T13:18:11.098414Z",
     "iopub.status.idle": "2025-05-06T13:18:11.140408Z",
     "shell.execute_reply": "2025-05-06T13:18:11.139338Z"
    },
    "papermill": {
     "duration": 0.054085,
     "end_time": "2025-05-06T13:18:11.142070",
     "exception": false,
     "start_time": "2025-05-06T13:18:11.087985",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1458: RuntimeWarning: invalid value encountered in greater\n",
      "  has_large_values = (abs_vals > 1e6).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in less\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in greater\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1458: RuntimeWarning: invalid value encountered in greater\n",
      "  has_large_values = (abs_vals > 1e6).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in less\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n",
      "/usr/local/lib/python3.11/dist-packages/pandas/io/formats/format.py:1459: RuntimeWarning: invalid value encountered in greater\n",
      "  has_small_values = ((abs_vals < 10 ** (-self.digits)) & (abs_vals > 0)).any()\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>team</th>\n",
       "      <th>form</th>\n",
       "      <th>xG</th>\n",
       "      <th>shots</th>\n",
       "      <th>shotOnTarget</th>\n",
       "      <th>deep</th>\n",
       "      <th>is_home</th>\n",
       "      <th>possession_proxy</th>\n",
       "      <th>final_pos</th>\n",
       "      <th>...</th>\n",
       "      <th>opponent_xG</th>\n",
       "      <th>opponent_shots</th>\n",
       "      <th>opponent_shotOnTarget</th>\n",
       "      <th>opponent_deep</th>\n",
       "      <th>opponent_rolling_xG</th>\n",
       "      <th>opponent_rolling_shots</th>\n",
       "      <th>opponent_rolling_shotOnTarget</th>\n",
       "      <th>opponent_rolling_deep</th>\n",
       "      <th>opponent_rolling_team_form</th>\n",
       "      <th>opponent_rolling_possession_proxy</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.55411</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.672291</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.43355</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0.155379</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>1.334290</td>\n",
       "      <td>8.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.613273</td>\n",
       "      <td>13.00</td>\n",
       "      <td>3.0</td>\n",
       "      <td>15.00</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.097264</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2014-08-31</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.29649</td>\n",
       "      <td>24</td>\n",
       "      <td>6</td>\n",
       "      <td>13</td>\n",
       "      <td>0</td>\n",
       "      <td>0.221795</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>0.809743</td>\n",
       "      <td>9.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>0.914597</td>\n",
       "      <td>8.50</td>\n",
       "      <td>3.5</td>\n",
       "      <td>1.00</td>\n",
       "      <td>0.5</td>\n",
       "      <td>0.133393</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2014-09-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.07804</td>\n",
       "      <td>15</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.142124</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2014-09-20</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.36224</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>0.603193</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>0.649013</td>\n",
       "      <td>6.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.689573</td>\n",
       "      <td>8.25</td>\n",
       "      <td>1.5</td>\n",
       "      <td>3.75</td>\n",
       "      <td>2.5</td>\n",
       "      <td>0.171188</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 28 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        date     team  form       xG  shots  shotOnTarget  deep  is_home  \\\n",
       "0 2014-08-16  Arsenal     3  1.55411     14             6     9        1   \n",
       "1 2014-08-23  Arsenal     1  1.43355     13             3     8        0   \n",
       "2 2014-08-31  Arsenal     1  2.29649     24             6    13        0   \n",
       "3 2014-09-13  Arsenal     1  2.07804     15             6     9        1   \n",
       "4 2014-09-20  Arsenal     0  1.36224      9             3     7        0   \n",
       "\n",
       "   possession_proxy  final_pos  ...  opponent_xG  opponent_shots  \\\n",
       "0          0.672291          3  ...          NaN             NaN   \n",
       "1          0.155379          3  ...     1.334290             8.0   \n",
       "2          0.221795          3  ...     0.809743             9.0   \n",
       "3          0.142124          3  ...          NaN             NaN   \n",
       "4          0.603193          3  ...     0.649013             6.0   \n",
       "\n",
       "   opponent_shotOnTarget  opponent_deep  opponent_rolling_xG  \\\n",
       "0                    NaN            NaN                  NaN   \n",
       "1                    2.0            3.0             0.613273   \n",
       "2                    3.0            4.0             0.914597   \n",
       "3                    NaN            NaN                  NaN   \n",
       "4                    2.0            0.0             0.689573   \n",
       "\n",
       "   opponent_rolling_shots opponent_rolling_shotOnTarget opponent_rolling_deep  \\\n",
       "0                     NaN                           NaN                   NaN   \n",
       "1                   13.00                           3.0                 15.00   \n",
       "2                    8.50                           3.5                  1.00   \n",
       "3                     NaN                           NaN                   NaN   \n",
       "4                    8.25                           1.5                  3.75   \n",
       "\n",
       "   opponent_rolling_team_form  opponent_rolling_possession_proxy  \n",
       "0                         NaN                                NaN  \n",
       "1                         1.0                           0.097264  \n",
       "2                         0.5                           0.133393  \n",
       "3                         NaN                                NaN  \n",
       "4                         2.5                           0.171188  \n",
       "\n",
       "[5 rows x 28 columns]"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "train2_df = team_df.merge(\n",
    "    prepared_df[['date','home_team', 'away_team', 'xG_home', *[f'home_{stat}' for stat in ['shots', 'shotOnTarget', 'deep']], *[f'rolling_{stat}' for stat in ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']]]], \n",
    "    left_on= ['date', 'team'],\n",
    "    right_on = ['date', 'away_team'],\n",
    "    how = 'left',\n",
    "    suffixes = ['','_home']\n",
    ")\n",
    "#train_df.head(10).filter(['date', 'team', 'away_team', 'rolling_xG_away'])\n",
    "train2_df.columns\n",
    "rename_dict = {\n",
    "                'team_form': 'form',\n",
    "               'home_team': 'opponent',\n",
    "               'xG_home': 'opponent_xG',\n",
    "               **{f'home_{stat}': f'opponent_{stat}' for stat in ['shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']},\n",
    "               **{f'rolling_{stat}_home': f'opponent_rolling_{stat}' for stat in ['xG', 'shots', 'shotOnTarget', 'deep', 'team_form', 'possession_proxy']}}\n",
    "train2_df = train2_df.rename(columns =rename_dict)\n",
    "train2_df.head(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "4604343b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:11.162993Z",
     "iopub.status.busy": "2025-05-06T13:18:11.162685Z",
     "iopub.status.idle": "2025-05-06T13:18:11.181291Z",
     "shell.execute_reply": "2025-05-06T13:18:11.180231Z"
    },
    "papermill": {
     "duration": 0.0309,
     "end_time": "2025-05-06T13:18:11.183124",
     "exception": false,
     "start_time": "2025-05-06T13:18:11.152224",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "final_df = train1_df.copy()\n",
    "\n",
    "# Fill in missing values in train1_df with values from train2_df\n",
    "final_df = final_df.fillna(train2_df)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "b149e2e4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:11.202988Z",
     "iopub.status.busy": "2025-05-06T13:18:11.202562Z",
     "iopub.status.idle": "2025-05-06T13:18:11.230225Z",
     "shell.execute_reply": "2025-05-06T13:18:11.229272Z"
    },
    "papermill": {
     "duration": 0.039644,
     "end_time": "2025-05-06T13:18:11.232192",
     "exception": false,
     "start_time": "2025-05-06T13:18:11.192548",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>team</th>\n",
       "      <th>form</th>\n",
       "      <th>xG</th>\n",
       "      <th>shots</th>\n",
       "      <th>shotOnTarget</th>\n",
       "      <th>deep</th>\n",
       "      <th>is_home</th>\n",
       "      <th>possession_proxy</th>\n",
       "      <th>final_pos</th>\n",
       "      <th>...</th>\n",
       "      <th>opponent_xG</th>\n",
       "      <th>opponent_shots</th>\n",
       "      <th>opponent_shotOnTarget</th>\n",
       "      <th>opponent_deep</th>\n",
       "      <th>opponent_rolling_xG</th>\n",
       "      <th>opponent_rolling_shots</th>\n",
       "      <th>opponent_rolling_shotOnTarget</th>\n",
       "      <th>opponent_rolling_deep</th>\n",
       "      <th>opponent_rolling_team_form</th>\n",
       "      <th>opponent_rolling_possession_proxy</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.55411</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.672291</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>0.158151</td>\n",
       "      <td>4.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.875943</td>\n",
       "      <td>19.490938</td>\n",
       "      <td>6.143898</td>\n",
       "      <td>9.325717</td>\n",
       "      <td>2.070722</td>\n",
       "      <td>0.245370</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.43355</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0.155379</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>1.334290</td>\n",
       "      <td>8.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.613273</td>\n",
       "      <td>13.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.097264</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2014-08-31</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.29649</td>\n",
       "      <td>24</td>\n",
       "      <td>6</td>\n",
       "      <td>13</td>\n",
       "      <td>0</td>\n",
       "      <td>0.221795</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>0.809743</td>\n",
       "      <td>9.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>0.914597</td>\n",
       "      <td>8.500000</td>\n",
       "      <td>3.500000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.500000</td>\n",
       "      <td>0.133393</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2014-09-13</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>2.07804</td>\n",
       "      <td>15</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.142124</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>2.308340</td>\n",
       "      <td>15.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>1.228683</td>\n",
       "      <td>12.666667</td>\n",
       "      <td>3.666667</td>\n",
       "      <td>13.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.194661</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2014-09-20</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>0</td>\n",
       "      <td>1.36224</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>0.603193</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>0.649013</td>\n",
       "      <td>6.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.689573</td>\n",
       "      <td>8.250000</td>\n",
       "      <td>1.500000</td>\n",
       "      <td>3.750000</td>\n",
       "      <td>2.500000</td>\n",
       "      <td>0.171188</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 28 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        date     team  form       xG  shots  shotOnTarget  deep  is_home  \\\n",
       "0 2014-08-16  Arsenal     3  1.55411     14             6     9        1   \n",
       "1 2014-08-23  Arsenal     1  1.43355     13             3     8        0   \n",
       "2 2014-08-31  Arsenal     1  2.29649     24             6    13        0   \n",
       "3 2014-09-13  Arsenal     1  2.07804     15             6     9        1   \n",
       "4 2014-09-20  Arsenal     0  1.36224      9             3     7        0   \n",
       "\n",
       "   possession_proxy  final_pos  ...  opponent_xG  opponent_shots  \\\n",
       "0          0.672291          3  ...     0.158151             4.0   \n",
       "1          0.155379          3  ...     1.334290             8.0   \n",
       "2          0.221795          3  ...     0.809743             9.0   \n",
       "3          0.142124          3  ...     2.308340            15.0   \n",
       "4          0.603193          3  ...     0.649013             6.0   \n",
       "\n",
       "   opponent_shotOnTarget  opponent_deep  opponent_rolling_xG  \\\n",
       "0                    2.0            0.0             1.875943   \n",
       "1                    2.0            3.0             0.613273   \n",
       "2                    3.0            4.0             0.914597   \n",
       "3                    8.0           16.0             1.228683   \n",
       "4                    2.0            0.0             0.689573   \n",
       "\n",
       "   opponent_rolling_shots opponent_rolling_shotOnTarget opponent_rolling_deep  \\\n",
       "0               19.490938                      6.143898              9.325717   \n",
       "1               13.000000                      3.000000             15.000000   \n",
       "2                8.500000                      3.500000              1.000000   \n",
       "3               12.666667                      3.666667             13.000000   \n",
       "4                8.250000                      1.500000              3.750000   \n",
       "\n",
       "   opponent_rolling_team_form  opponent_rolling_possession_proxy  \n",
       "0                    2.070722                           0.245370  \n",
       "1                    1.000000                           0.097264  \n",
       "2                    0.500000                           0.133393  \n",
       "3                    1.000000                           0.194661  \n",
       "4                    2.500000                           0.171188  \n",
       "\n",
       "[5 rows x 28 columns]"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "final_df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "0e9d8ad5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:11.266622Z",
     "iopub.status.busy": "2025-05-06T13:18:11.266314Z",
     "iopub.status.idle": "2025-05-06T13:18:11.506421Z",
     "shell.execute_reply": "2025-05-06T13:18:11.505178Z"
    },
    "papermill": {
     "duration": 0.259917,
     "end_time": "2025-05-06T13:18:11.508606",
     "exception": false,
     "start_time": "2025-05-06T13:18:11.248689",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "final_df.to_csv('csv_file.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "d56db05d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-05-06T13:18:11.535324Z",
     "iopub.status.busy": "2025-05-06T13:18:11.534291Z",
     "iopub.status.idle": "2025-05-06T13:18:11.587488Z",
     "shell.execute_reply": "2025-05-06T13:18:11.586505Z"
    },
    "papermill": {
     "duration": 0.065596,
     "end_time": "2025-05-06T13:18:11.589153",
     "exception": false,
     "start_time": "2025-05-06T13:18:11.523557",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>date</th>\n",
       "      <th>team</th>\n",
       "      <th>form</th>\n",
       "      <th>xG</th>\n",
       "      <th>shots</th>\n",
       "      <th>shotOnTarget</th>\n",
       "      <th>deep</th>\n",
       "      <th>is_home</th>\n",
       "      <th>possession_proxy</th>\n",
       "      <th>final_pos</th>\n",
       "      <th>...</th>\n",
       "      <th>opponent_shots</th>\n",
       "      <th>opponent_shotOnTarget</th>\n",
       "      <th>opponent_deep</th>\n",
       "      <th>opponent_rolling_xG</th>\n",
       "      <th>opponent_rolling_shots</th>\n",
       "      <th>opponent_rolling_shotOnTarget</th>\n",
       "      <th>opponent_rolling_deep</th>\n",
       "      <th>opponent_rolling_team_form</th>\n",
       "      <th>opponent_rolling_possession_proxy</th>\n",
       "      <th>season</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>3</td>\n",
       "      <td>1.554110</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0.672291</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>4.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.875943</td>\n",
       "      <td>19.490938</td>\n",
       "      <td>6.143898</td>\n",
       "      <td>9.325717</td>\n",
       "      <td>2.070722</td>\n",
       "      <td>0.245370</td>\n",
       "      <td>2014</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Arsenal</td>\n",
       "      <td>1</td>\n",
       "      <td>1.433550</td>\n",
       "      <td>13</td>\n",
       "      <td>3</td>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>0.155379</td>\n",
       "      <td>3</td>\n",
       "      <td>...</td>\n",
       "      <td>8.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.613273</td>\n",
       "      <td>13.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.097264</td>\n",
       "      <td>2014</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>415</th>\n",
       "      <td>2014-08-16</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>3</td>\n",
       "      <td>0.909774</td>\n",
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.204729</td>\n",
       "      <td>17</td>\n",
       "      <td>...</td>\n",
       "      <td>12.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>2.008469</td>\n",
       "      <td>20.867879</td>\n",
       "      <td>6.577935</td>\n",
       "      <td>9.984534</td>\n",
       "      <td>2.217009</td>\n",
       "      <td>0.262704</td>\n",
       "      <td>2014</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>416</th>\n",
       "      <td>2014-08-23</td>\n",
       "      <td>Aston Villa</td>\n",
       "      <td>1</td>\n",
       "      <td>0.507525</td>\n",
       "      <td>10</td>\n",
       "      <td>0</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.126164</td>\n",
       "      <td>17</td>\n",
       "      <td>...</td>\n",
       "      <td>11.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>0.965583</td>\n",
       "      <td>12.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>0.118423</td>\n",
       "      <td>2014</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1467</th>\n",
       "      <td>2014-08-18</td>\n",
       "      <td>Burnley</td>\n",
       "      <td>3</td>\n",
       "      <td>0.371141</td>\n",
       "      <td>9</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.044517</td>\n",
       "      <td>19</td>\n",
       "      <td>...</td>\n",
       "      <td>11.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>10.0</td>\n",
       "      <td>2.058318</td>\n",
       "      <td>21.385805</td>\n",
       "      <td>6.741194</td>\n",
       "      <td>10.232343</td>\n",
       "      <td>2.272033</td>\n",
       "      <td>0.269224</td>\n",
       "      <td>2014</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5729</th>\n",
       "      <td>2022-08-14</td>\n",
       "      <td>Nottingham Forest</td>\n",
       "      <td>0</td>\n",
       "      <td>1.971700</td>\n",
       "      <td>13</td>\n",
       "      <td>6</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0.145762</td>\n",
       "      <td>16</td>\n",
       "      <td>...</td>\n",
       "      <td>19.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>1.046950</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>2.600000</td>\n",
       "      <td>4.400000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.100248</td>\n",
       "      <td>2022</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4331</th>\n",
       "      <td>2023-08-12</td>\n",
       "      <td>Luton</td>\n",
       "      <td>0</td>\n",
       "      <td>1.885940</td>\n",
       "      <td>9</td>\n",
       "      <td>3</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>0.090476</td>\n",
       "      <td>18</td>\n",
       "      <td>...</td>\n",
       "      <td>27.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>1.713293</td>\n",
       "      <td>14.800000</td>\n",
       "      <td>5.400000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>0.144485</td>\n",
       "      <td>2023</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4332</th>\n",
       "      <td>2023-08-25</td>\n",
       "      <td>Luton</td>\n",
       "      <td>0</td>\n",
       "      <td>0.465741</td>\n",
       "      <td>11</td>\n",
       "      <td>1</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>0.036012</td>\n",
       "      <td>18</td>\n",
       "      <td>...</td>\n",
       "      <td>19.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>17.0</td>\n",
       "      <td>1.680220</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>4.800000</td>\n",
       "      <td>11.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.143849</td>\n",
       "      <td>2023</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3391</th>\n",
       "      <td>2024-08-17</td>\n",
       "      <td>Ipswich</td>\n",
       "      <td>3</td>\n",
       "      <td>0.342601</td>\n",
       "      <td>7</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0.024061</td>\n",
       "      <td>18</td>\n",
       "      <td>...</td>\n",
       "      <td>19.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>2.997160</td>\n",
       "      <td>25.200000</td>\n",
       "      <td>9.800000</td>\n",
       "      <td>19.000000</td>\n",
       "      <td>2.200000</td>\n",
       "      <td>0.196378</td>\n",
       "      <td>2024</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3392</th>\n",
       "      <td>2024-08-24</td>\n",
       "      <td>Ipswich</td>\n",
       "      <td>0</td>\n",
       "      <td>0.479999</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0.040470</td>\n",
       "      <td>18</td>\n",
       "      <td>...</td>\n",
       "      <td>14.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>2.775266</td>\n",
       "      <td>16.600000</td>\n",
       "      <td>8.600000</td>\n",
       "      <td>12.800000</td>\n",
       "      <td>1.200000</td>\n",
       "      <td>0.315155</td>\n",
       "      <td>2024</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>70 rows × 29 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "           date               team  form        xG  shots  shotOnTarget  deep  \\\n",
       "0    2014-08-16            Arsenal     3  1.554110     14             6     9   \n",
       "1    2014-08-23            Arsenal     1  1.433550     13             3     8   \n",
       "415  2014-08-16        Aston Villa     3  0.909774      7             1     4   \n",
       "416  2014-08-23        Aston Villa     1  0.507525     10             0     4   \n",
       "1467 2014-08-18            Burnley     3  0.371141      9             2     2   \n",
       "...         ...                ...   ...       ...    ...           ...   ...   \n",
       "5729 2022-08-14  Nottingham Forest     0  1.971700     13             6     4   \n",
       "4331 2023-08-12              Luton     0  1.885940      9             3     5   \n",
       "4332 2023-08-25              Luton     0  0.465741     11             1     4   \n",
       "3391 2024-08-17            Ipswich     3  0.342601      7             2     2   \n",
       "3392 2024-08-24            Ipswich     0  0.479999      1             1     1   \n",
       "\n",
       "      is_home  possession_proxy  final_pos  ...  opponent_shots  \\\n",
       "0           1          0.672291          3  ...             4.0   \n",
       "1           0          0.155379          3  ...             8.0   \n",
       "415         0          0.204729         17  ...            12.0   \n",
       "416         1          0.126164         17  ...            11.0   \n",
       "1467        1          0.044517         19  ...            11.0   \n",
       "...       ...               ...        ...  ...             ...   \n",
       "5729        1          0.145762         16  ...            19.0   \n",
       "4331        0          0.090476         18  ...            27.0   \n",
       "4332        0          0.036012         18  ...            19.0   \n",
       "3391        1          0.024061         18  ...            19.0   \n",
       "3392        0          0.040470         18  ...            14.0   \n",
       "\n",
       "      opponent_shotOnTarget  opponent_deep  opponent_rolling_xG  \\\n",
       "0                       2.0            0.0             1.875943   \n",
       "1                       2.0            3.0             0.613273   \n",
       "415                     2.0            3.0             2.008469   \n",
       "416                     4.0            7.0             0.965583   \n",
       "1467                    3.0           10.0             2.058318   \n",
       "...                     ...            ...                  ...   \n",
       "5729                    5.0            7.0             1.046950   \n",
       "4331                   12.0           17.0             1.713293   \n",
       "4332                    8.0           17.0             1.680220   \n",
       "3391                    5.0           13.0             2.997160   \n",
       "3392                    5.0           15.0             2.775266   \n",
       "\n",
       "      opponent_rolling_shots  opponent_rolling_shotOnTarget  \\\n",
       "0                  19.490938                       6.143898   \n",
       "1                  13.000000                       3.000000   \n",
       "415                20.867879                       6.577935   \n",
       "416                12.000000                       0.000000   \n",
       "1467               21.385805                       6.741194   \n",
       "...                      ...                            ...   \n",
       "5729                8.000000                       2.600000   \n",
       "4331               14.800000                       5.400000   \n",
       "4332               15.000000                       4.800000   \n",
       "3391               25.200000                       9.800000   \n",
       "3392               16.600000                       8.600000   \n",
       "\n",
       "     opponent_rolling_deep opponent_rolling_team_form  \\\n",
       "0                 9.325717                   2.070722   \n",
       "1                15.000000                   1.000000   \n",
       "415               9.984534                   2.217009   \n",
       "416               6.000000                   3.000000   \n",
       "1467             10.232343                   2.272033   \n",
       "...                    ...                        ...   \n",
       "5729              4.400000                   2.000000   \n",
       "4331              7.000000                   2.000000   \n",
       "4332             11.000000                   1.000000   \n",
       "3391             19.000000                   2.200000   \n",
       "3392             12.800000                   1.200000   \n",
       "\n",
       "      opponent_rolling_possession_proxy  season  \n",
       "0                              0.245370    2014  \n",
       "1                              0.097264    2014  \n",
       "415                            0.262704    2014  \n",
       "416                            0.118423    2014  \n",
       "1467                           0.269224    2014  \n",
       "...                                 ...     ...  \n",
       "5729                           0.100248    2022  \n",
       "4331                           0.144485    2023  \n",
       "4332                           0.143849    2023  \n",
       "3391                           0.196378    2024  \n",
       "3392                           0.315155    2024  \n",
       "\n",
       "[70 rows x 29 columns]"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#arrangements according to the season instead of date.\n",
    "final_df['date'] = pd.to_datetime(final_df['date'])\n",
    "final_df['season'] = final_df['date'].apply(lambda x: x.year if x.month >= 8 else x.year-1)\n",
    "\n",
    "final_df = final_df.sort_values(['season', 'team', 'date'])\n",
    "grouped = final_df.groupby(['team', 'season'])\n",
    "\n",
    "final_df.groupby('team').head(2)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "0f1a6532",
   "metadata": {
    "papermill": {
     "duration": 0.00993,
     "end_time": "2025-05-06T13:18:11.609361",
     "exception": false,
     "start_time": "2025-05-06T13:18:11.599431",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "none",
   "dataSources": [
    {
     "datasetId": 6404764,
     "sourceId": 10889179,
     "sourceType": "datasetVersion"
    },
    {
     "datasetId": 7324477,
     "sourceId": 11671066,
     "sourceType": "datasetVersion"
    },
    {
     "datasetId": 7328078,
     "sourceId": 11675990,
     "sourceType": "datasetVersion"
    }
   ],
   "dockerImageVersionId": 31012,
   "isGpuEnabled": false,
   "isInternetEnabled": true,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.11"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 10.723707,
   "end_time": "2025-05-06T13:18:12.239788",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-05-06T13:18:01.516081",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
